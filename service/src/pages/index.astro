---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Whatsaly">
  <!-- Top Left Action Icons (Fork, Star, Chat) -->
  <div
    id="top-left-actions"
    class="fixed top-4 left-4 z-50 flex items-center gap-2 bg-gh-bg border border-gh-border rounded-gh p-1.5 shadow-lg"
  >
    <a
      href="https://github.com/astrox11/Whatsaly/fork"
      target="_blank"
      rel="noopener noreferrer"
      class="p-2 text-gh-text-secondary hover:text-gh-accent hover:bg-gh-bg-tertiary rounded-gh transition-colors"
      data-tooltip="Fork Repository"
    >
      <svg
        class="w-4 h-4 sm:w-5 sm:h-5"
        viewBox="0 0 16 16"
        fill="currentColor"
      >
        <path
          d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"
        ></path>
      </svg>
    </a>
    <a
      href="https://github.com/astrox11/Whatsaly"
      target="_blank"
      rel="noopener noreferrer"
      class="p-2 text-gh-text-secondary hover:text-gh-warning hover:bg-gh-bg-tertiary rounded-gh transition-colors"
      data-tooltip="Star Repository"
    >
      <svg
        class="w-4 h-4 sm:w-5 sm:h-5"
        viewBox="0 0 16 16"
        fill="currentColor"
      >
        <path
          d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"
        ></path>
      </svg>
    </a>
    <a
      href="https://wa.me/2348062795602"
      target="_blank"
      rel="noopener noreferrer"
      class="p-2 text-gh-text-secondary hover:text-gh-success hover:bg-gh-bg-tertiary rounded-gh transition-colors"
      data-tooltip="Chat on WhatsApp"
    >
      <svg
        class="w-4 h-4 sm:w-5 sm:h-5"
        viewBox="0 0 16 16"
        fill="currentColor"
      >
        <path
          d="M1.75 1h8.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 10.25 10H7.061l-2.574 2.573A1.458 1.458 0 0 1 2 11.543V10h-.25A1.75 1.75 0 0 1 0 8.25v-5.5C0 1.784.784 1 1.75 1ZM1.5 2.75v5.5c0 .138.112.25.25.25h1a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h3.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13 2a.25.25 0 0 0-.25-.25h-.5a.75.75 0 0 1 0-1.5h.5c.966 0 1.75.784 1.75 1.75v5.5a1.75 1.75 0 0 1-1.75 1.75H14v1.543a1.458 1.458 0 0 1-2.487 1.03L9.22 12.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.22 2.22v-2.19a.75.75 0 0 1 .75-.75h1a.25.25 0 0 0 .25-.25Z"
        ></path>
      </svg>
    </a>
    <div class="w-px h-5 bg-gh-border mx-0.5"></div>
    <!-- Theme Switcher -->
    <button
      id="theme-toggle"
      class="p-2 text-gh-text-secondary hover:text-gh-accent hover:bg-gh-bg-tertiary rounded-gh transition-colors"
      data-tooltip="Toggle Theme"
    >
      <svg
        id="theme-icon-light"
        class="w-4 h-4 sm:w-5 sm:h-5 hidden"
        viewBox="0 0 16 16"
        fill="currentColor"
      >
        <path
          d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm0 1.5a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11ZM8 0a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0Zm0 13a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 8 13ZM2.343 2.343a.75.75 0 0 1 1.061 0l1.06 1.061a.75.75 0 0 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06Zm9.193 9.193a.75.75 0 0 1 1.06 0l1.061 1.06a.75.75 0 0 1-1.06 1.061l-1.061-1.06a.75.75 0 0 1 0-1.061ZM0 8a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 8Zm13 0a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5A.75.75 0 0 1 13 8ZM2.343 13.657a.75.75 0 0 1 0-1.061l1.06-1.06a.75.75 0 0 1 1.061 1.06l-1.06 1.06a.75.75 0 0 1-1.06 0Zm9.193-9.193a.75.75 0 0 1 0-1.06l1.061-1.061a.75.75 0 1 1 1.06 1.06l-1.06 1.061a.75.75 0 0 1-1.06 0Z"
        ></path>
      </svg>
      <svg
        id="theme-icon-dark"
        class="w-4 h-4 sm:w-5 sm:h-5 hidden"
        viewBox="0 0 16 16"
        fill="currentColor"
      >
        <path
          d="M9.598 1.591a.749.749 0 0 1 .785-.175 7.001 7.001 0 1 1-8.967 8.967.75.75 0 0 1 .961-.96 5.5 5.5 0 0 0 7.046-7.046.75.75 0 0 1 .175-.786Zm1.616 1.945a7 7 0 0 1-7.678 7.678 5.499 5.499 0 1 0 7.678-7.678Z"
        ></path>
      </svg>
      <svg
        id="theme-icon-auto"
        class="w-4 h-4 sm:w-5 sm:h-5"
        viewBox="0 0 16 16"
        fill="currentColor"
      >
        <path
          d="M14.064 0a8.75 8.75 0 0 0-6.187 2.563l-.459.458c-.314.314-.616.641-.904.979H3.31a1.75 1.75 0 0 0-1.49.833L.11 7.607a.75.75 0 0 0 .418 1.11l3.102.954c.037.051.079.1.124.145l2.429 2.428c.046.046.094.088.145.125l.954 3.102a.75.75 0 0 0 1.11.418l2.774-1.707a1.75 1.75 0 0 0 .833-1.49V9.485c.338-.288.665-.59.979-.904l.458-.459A8.75 8.75 0 0 0 16 1.936V1.75A1.75 1.75 0 0 0 14.25 0ZM3.09 8.854a10.575 10.575 0 0 1 2.835-4.333l.459-.458a7.25 7.25 0 0 1 7.587-1.65v.186a7.25 7.25 0 0 1-2.127 5.126l-.459.458a10.575 10.575 0 0 1-4.333 2.835L3.09 8.854Zm1.086 2.56 2.41 2.41-.402 1.308-3.316-3.316ZM14.5 1.936a7.278 7.278 0 0 1-.753 2.338 7.278 7.278 0 0 1 2.338-.753V1.936ZM5 6.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"
        ></path>
      </svg>
    </button>
  </div>

  <!-- Desktop Sidebar (hidden on mobile) -->
  <aside
    id="desktop-sidebar"
    class="hidden lg:flex fixed left-4 top-1/2 -translate-y-1/2 z-50 flex-col gap-2 bg-gh-bg border border-gh-border rounded-gh p-2 shadow-lg"
  >
    <button
      id="sidebar-info"
      class="p-2 text-gh-text-secondary hover:text-gh-accent hover:bg-gh-bg-tertiary rounded-gh transition-colors"
      data-tooltip="Info"
    >
      <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
        <path
          d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"
        ></path>
      </svg>
    </button>
    <button
      id="sidebar-settings"
      class="p-2 text-gh-text-secondary hover:text-gh-accent hover:bg-gh-bg-tertiary rounded-gh transition-colors"
      data-tooltip="Settings"
    >
      <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
        <path
          d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.04.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.102-.302c-.067-.019-.177-.011-.3.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.212.224l-.288 1.107c-.17.645-.715 1.195-1.458 1.26a8.006 8.006 0 0 1-1.402 0c-.743-.065-1.289-.615-1.458-1.26l-.289-1.106c-.018-.066-.079-.158-.212-.225a5.893 5.893 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.004 8.004 0 0 1-.704-1.217c-.315-.675-.111-1.422.363-1.891l.815-.806c.05-.048.098-.147.088-.294a6.854 6.854 0 0 1 0-.772c.01-.147-.04-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.102.302c.067.019.177.011.3-.071.214-.143.437-.272.668-.386.133-.066.194-.158.212-.224l.289-1.106C6.009.645 6.556.095 7.299.03 7.53.01 7.764 0 8 0Zm-.571 1.525c-.036.003-.108.036-.137.146l-.289 1.106c-.1.386-.396.71-.771.9-.31.157-.6.346-.87.562-.262.211-.597.3-.912.214l-1.103-.303c-.109-.03-.175.016-.195.045-.22.312-.412.644-.573.99-.014.031-.021.11.059.19l.815.806c.278.275.41.657.397 1.036-.007.21-.007.42 0 .628.013.379-.119.762-.397 1.037l-.814.806c-.08.08-.073.159-.059.19.161.347.353.678.573.99.02.029.086.074.195.045l1.103-.303c.315-.086.65.003.912.214.27.216.56.405.87.562.375.19.671.514.77.9l.29 1.106c.028.11.1.143.136.146a6.66 6.66 0 0 0 1.142 0c.036-.003.108-.036.137-.146l.289-1.106c.1-.386.396-.71.771-.9.31-.157.6-.346.87-.562.262-.211.597-.3.912-.214l1.103.303c.109.029.175-.016.194-.045.22-.312.413-.644.573-.99.015-.031.022-.11-.058-.19l-.815-.806a1.337 1.337 0 0 1-.397-1.037c.007-.21.007-.42 0-.628-.013-.379.119-.762.397-1.036l.814-.806c.08-.08.073-.159.059-.19a6.964 6.964 0 0 0-.574-.99c-.02-.029-.085-.074-.194-.045l-1.103.303c-.315.086-.65-.003-.912-.214a5.421 5.421 0 0 0-.87-.562c-.375-.19-.67-.514-.77-.9l-.29-1.106c-.028-.11-.1-.143-.136-.146a6.66 6.66 0 0 0-1.142 0ZM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm-1.5 0a1.5 1.5 0 1 0-3.001.001A1.5 1.5 0 0 0 9.5 8Z"
        ></path>
      </svg>
    </button>
    <button
      id="sidebar-console"
      class="p-2 text-gh-text-secondary hover:text-gh-text hover:bg-gh-bg-tertiary rounded-gh transition-colors"
      data-tooltip="View Logs"
    >
      <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
        <path
          d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25Zm7.25 2a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5ZM4.78 6.72a.75.75 0 0 0-1.06 1.06l1.22 1.22-1.22 1.22a.75.75 0 1 0 1.06 1.06l1.75-1.75a.75.75 0 0 0 0-1.06Z"
        ></path>
      </svg>
    </button>
    <div class="h-px bg-gh-border my-1"></div>
    <button
      id="sidebar-report"
      class="p-2 text-gh-text-secondary hover:text-gh-warning hover:bg-gh-bg-tertiary rounded-gh transition-colors"
      data-tooltip="Report"
    >
      <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
        <path
          d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"
        ></path>
      </svg>
    </button>
    <a
      href="https://github.com/astrox11/Whatsaly/pulls"
      target="_blank"
      rel="noopener noreferrer"
      class="p-2 text-gh-text-secondary hover:text-gh-success hover:bg-gh-bg-tertiary rounded-gh transition-colors"
      data-tooltip="Contribute"
    >
      <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
        <path
          d="M1.5 3.25a2.25 2.25 0 1 1 3 2.122v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.25 2.25 0 0 1 1.5 3.25Zm5.677-.177L9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM3.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm0 9.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm8.25.75a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Z"
        ></path>
      </svg>
    </a>
  </aside>

  <!-- Mobile Sidebar (fixed bottom bar) -->
  <nav
    id="mobile-sidebar"
    class="lg:hidden fixed bottom-0 left-0 right-0 z-50 bg-gh-bg border-t border-gh-border shadow-lg"
  >
    <div class="flex items-center justify-around py-2 px-2 sm:px-4">
      <button
        id="mobile-info"
        class="flex flex-col items-center p-1.5 sm:p-2 text-gh-text-secondary hover:text-gh-accent transition-colors"
        data-tooltip="Info"
      >
        <svg
          class="w-4 h-4 sm:w-5 sm:h-5"
          viewBox="0 0 16 16"
          fill="currentColor"
        >
          <path
            d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"
          ></path>
        </svg>
        <span class="text-[9px] sm:text-[10px] mt-0.5">Info</span>
      </button>
      <button
        id="mobile-settings"
        class="flex flex-col items-center p-1.5 sm:p-2 text-gh-text-secondary hover:text-gh-accent transition-colors"
        data-tooltip="Settings"
      >
        <svg
          class="w-4 h-4 sm:w-5 sm:h-5"
          viewBox="0 0 16 16"
          fill="currentColor"
        >
          <path
            d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.04.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.102-.302c-.067-.019-.177-.011-.3.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.212.224l-.288 1.107c-.17.645-.715 1.195-1.458 1.26a8.006 8.006 0 0 1-1.402 0c-.743-.065-1.289-.615-1.458-1.26l-.289-1.106c-.018-.066-.079-.158-.212-.225a5.893 5.893 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.004 8.004 0 0 1-.704-1.217c-.315-.675-.111-1.422.363-1.891l.815-.806c.05-.048.098-.147.088-.294a6.854 6.854 0 0 1 0-.772c.01-.147-.04-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.102.302c.067.019.177.011.3-.071.214-.143.437-.272.668-.386.133-.066.194-.158.212-.224l.289-1.106C6.009.645 6.556.095 7.299.03 7.53.01 7.764 0 8 0Zm-.571 1.525c-.036.003-.108.036-.137.146l-.289 1.106c-.1.386-.396.71-.771.9-.31.157-.6.346-.87.562-.262.211-.597.3-.912.214l-1.103-.303c-.109-.03-.175.016-.195.045-.22.312-.412.644-.573.99-.014.031-.021.11.059.19l.815.806c.278.275.41.657.397 1.036-.007.21-.007.42 0 .628.013.379-.119.762-.397 1.037l-.814.806c-.08.08-.073.159-.059.19.161.347.353.678.573.99.02.029.086.074.195.045l1.103-.303c.315-.086.65.003.912.214.27.216.56.405.87.562.375.19.671.514.77.9l.29 1.106c.028.11.1.143.136.146a6.66 6.66 0 0 0 1.142 0c.036-.003.108-.036.137-.146l.289-1.106c.1-.386.396-.71.771-.9.31-.157.6-.346.87-.562.262-.211.597-.3.912-.214l1.103.303c.109.029.175-.016.194-.045.22-.312.413-.644.573-.99.015-.031.022-.11-.058-.19l-.815-.806a1.337 1.337 0 0 1-.397-1.037c.007-.21.007-.42 0-.628-.013-.379.119-.762.397-1.036l.814-.806c.08-.08.073-.159.059-.19a6.964 6.964 0 0 0-.574-.99c-.02-.029-.085-.074-.194-.045l-1.103.303c-.315.086-.65-.003-.912-.214a5.421 5.421 0 0 0-.87-.562c-.375-.19-.67-.514-.77-.9l-.29-1.106c-.028-.11-.1-.143-.136-.146a6.66 6.66 0 0 0-1.142 0ZM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm-1.5 0a1.5 1.5 0 1 0-3.001.001A1.5 1.5 0 0 0 9.5 8Z"
          ></path>
        </svg>
        <span class="text-[9px] sm:text-[10px] mt-0.5">Settings</span>
      </button>
      <button
        id="mobile-console"
        class="flex flex-col items-center p-1.5 sm:p-2 text-gh-text-secondary hover:text-gh-text transition-colors"
        data-tooltip="Logs"
      >
        <svg
          class="w-4 h-4 sm:w-5 sm:h-5"
          viewBox="0 0 16 16"
          fill="currentColor"
        >
          <path
            d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25Zm7.25 2a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5ZM4.78 6.72a.75.75 0 0 0-1.06 1.06l1.22 1.22-1.22 1.22a.75.75 0 1 0 1.06 1.06l1.75-1.75a.75.75 0 0 0 0-1.06Z"
          ></path>
        </svg>
        <span class="text-[9px] sm:text-[10px] mt-0.5">Logs</span>
      </button>
      <button
        id="mobile-report"
        class="flex flex-col items-center p-1.5 sm:p-2 text-gh-text-secondary hover:text-gh-warning transition-colors"
        data-tooltip="Report"
      >
        <svg
          class="w-4 h-4 sm:w-5 sm:h-5"
          viewBox="0 0 16 16"
          fill="currentColor"
        >
          <path
            d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"
          ></path>
        </svg>
        <span class="text-[9px] sm:text-[10px] mt-0.5">Report</span>
      </button>
      <a
        href="https://github.com/astrox11/Whatsaly/pulls"
        target="_blank"
        rel="noopener noreferrer"
        class="flex flex-col items-center p-1.5 sm:p-2 text-gh-text-secondary hover:text-gh-success transition-colors"
        data-tooltip="Contribute"
      >
        <svg
          class="w-4 h-4 sm:w-5 sm:h-5"
          viewBox="0 0 16 16"
          fill="currentColor"
        >
          <path
            d="M1.5 3.25a2.25 2.25 0 1 1 3 2.122v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.25 2.25 0 0 1 1.5 3.25Zm5.677-.177L9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM3.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm0 9.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm8.25.75a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Z"
          ></path>
        </svg>
        <span class="text-[9px] sm:text-[10px] mt-0.5">Contribute</span>
      </a>
    </div>
  </nav>

  <!-- Logs Modal -->
  <div id="logs-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50" id="logs-modal-backdrop"></div>
    <div
      class="absolute inset-4 lg:inset-20 bg-gh-bg border border-gh-border rounded-gh shadow-xl flex flex-col"
    >
      <div
        class="p-4 border-b border-gh-border flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <svg
            class="w-4 h-4 text-gh-text-secondary"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25Z"
            ></path>
          </svg>
          <h2 class="text-sm font-semibold text-gh-text">Application Logs</h2>
        </div>
        <button
          id="close-logs-modal"
          class="p-1 text-gh-text-secondary hover:text-gh-text transition-colors"
        >
          <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"
            ></path>
          </svg>
        </button>
      </div>
      <div
        id="logs-container"
        class="flex-1 p-4 overflow-auto font-mono text-xs text-gh-text-secondary bg-gh-bg-secondary"
      >
        <p class="text-gh-text-muted">Logs will appear here...</p>
      </div>
    </div>
  </div>

  <!-- Create Session Modal -->
  <div id="create-session-modal" class="fixed inset-0 z-50 hidden">
    <div
      class="absolute inset-0 bg-black/50"
      id="create-session-modal-backdrop"
    >
    </div>
    <div
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-gh-bg border border-gh-border rounded-gh shadow-xl"
    >
      <div
        class="p-4 border-b border-gh-border flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <svg
            class="w-4 h-4 text-gh-success"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M7.75 2a.75.75 0 0 1 .75.75V7h4.25a.75.75 0 0 1 0 1.5H8.5v4.25a.75.75 0 0 1-1.5 0V8.5H2.75a.75.75 0 0 1 0-1.5H7V2.75A.75.75 0 0 1 7.75 2Z"
            ></path>
          </svg>
          <h2 class="text-sm font-semibold text-gh-text">Create New Session</h2>
        </div>
        <button
          id="close-create-modal"
          class="p-1 text-gh-text-secondary hover:text-gh-text transition-colors"
        >
          <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"
            ></path>
          </svg>
        </button>
      </div>
      <form id="modal-session-form" class="p-4 space-y-4">
        <div>
          <label
            for="modal-phone"
            class="block text-sm font-medium text-gh-text mb-1"
            >Phone Number</label
          >
          <input
            type="tel"
            id="modal-phone"
            name="phoneNumber"
            placeholder="14155551234"
            required
            pattern="[0-9]+"
            class="w-full px-3 py-1.5 text-sm bg-gh-bg border border-gh-border rounded-gh text-gh-text placeholder-gh-text-muted focus:outline-none focus:border-gh-accent focus:ring-1 focus:ring-gh-accent"
          />
          <p class="text-xs text-gh-text-muted mt-1">
            Include country code without + symbol
          </p>
        </div>
        <div>
          <label
            for="modal-botName"
            class="block text-sm font-medium text-gh-text mb-1"
            >Bot Name <span class="text-gh-text-muted font-normal"
              >(optional)</span
            ></label
          >
          <input
            type="text"
            id="modal-botName"
            name="botName"
            placeholder="My Bot"
            class="w-full px-3 py-1.5 text-sm bg-gh-bg border border-gh-border rounded-gh text-gh-text placeholder-gh-text-muted focus:outline-none focus:border-gh-accent focus:ring-1 focus:ring-gh-accent"
          />
        </div>
        <div
          id="modal-error-message"
          class="p-3 rounded-gh bg-gh-danger-subtle border border-gh-danger text-gh-danger text-sm hidden"
        >
        </div>
        <button
          type="submit"
          class="w-full py-2 px-4 text-sm font-medium rounded-gh bg-gh-success text-white hover:bg-green-700 transition-colors"
        >
          Create Session
        </button>
      </form>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50" id="settings-modal-backdrop">
    </div>
    <div
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg bg-gh-bg border border-gh-border rounded-gh shadow-xl max-h-[90vh] flex flex-col"
    >
      <div
        class="p-4 border-b border-gh-border flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <svg
            class="w-4 h-4 text-gh-accent"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.04.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.102-.302c-.067-.019-.177-.011-.3.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.212.224l-.288 1.107c-.17.645-.715 1.195-1.458 1.26a8.006 8.006 0 0 1-1.402 0c-.743-.065-1.289-.615-1.458-1.26l-.289-1.106c-.018-.066-.079-.158-.212-.225a5.893 5.893 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.004 8.004 0 0 1-.704-1.217c-.315-.675-.111-1.422.363-1.891l.815-.806c.05-.048.098-.147.088-.294a6.854 6.854 0 0 1 0-.772c.01-.147-.04-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.102.302c.067.019.177.011.3-.071.214-.143.437-.272.668-.386.133-.066.194-.158.212-.224l.289-1.106C6.009.645 6.556.095 7.299.03 7.53.01 7.764 0 8 0Zm-.571 1.525c-.036.003-.108.036-.137.146l-.289 1.106c-.1.386-.396.71-.771.9-.31.157-.6.346-.87.562-.262.211-.597.3-.912.214l-1.103-.303c-.109-.03-.175.016-.195.045-.22.312-.412.644-.573.99-.014.031-.021.11.059.19l.815.806c.278.275.41.657.397 1.036-.007.21-.007.42 0 .628.013.379-.119.762-.397 1.037l-.814.806c-.08.08-.073.159-.059.19.161.347.353.678.573.99.02.029.086.074.195.045l1.103-.303c.315-.086.65.003.912.214.27.216.56.405.87.562.375.19.671.514.77.9l.29 1.106c.028.11.1.143.136.146a6.66 6.66 0 0 0 1.142 0c.036-.003.108-.036.137-.146l.289-1.106c.1-.386.396-.71.771-.9.31-.157.6-.346.87-.562.262-.211.597-.3.912-.214l1.103.303c.109.029.175-.016.194-.045.22-.312.413-.644.573-.99.015-.031.022-.11-.058-.19l-.815-.806a1.337 1.337 0 0 1-.397-1.037c.007-.21.007-.42 0-.628-.013-.379.119-.762.397-1.036l.814-.806c.08-.08.073-.159.059-.19a6.964 6.964 0 0 0-.574-.99c-.02-.029-.085-.074-.194-.045l-1.103.303c-.315.086-.65-.003-.912-.214a5.421 5.421 0 0 0-.87-.562c-.375-.19-.67-.514-.77-.9l-.29-1.106c-.028-.11-.1-.143-.136-.146a6.66 6.66 0 0 0-1.142 0ZM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm-1.5 0a1.5 1.5 0 1 0-3.001.001A1.5 1.5 0 0 0 9.5 8Z"
            ></path>
          </svg>
          <h2 class="text-sm font-semibold text-gh-text">Activity Settings</h2>
        </div>
        <button
          id="close-settings-modal"
          class="p-1 text-gh-text-secondary hover:text-gh-text transition-colors"
        >
          <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"
            ></path>
          </svg>
        </button>
      </div>
      <div class="p-4 overflow-y-auto flex-1">
        <!-- Session Selector -->
        <div class="mb-4">
          <label
            for="settings-session-select"
            class="block text-sm font-medium text-gh-text mb-1"
          >
            Select Session
          </label>
          <select
            id="settings-session-select"
            class="w-full px-3 py-1.5 text-sm bg-gh-bg border border-gh-border rounded-gh text-gh-text focus:outline-none focus:border-gh-accent focus:ring-1 focus:ring-gh-accent"
          >
            <option value="">-- Select a session --</option>
          </select>
          <p
            id="settings-no-sessions"
            class="text-xs text-gh-text-muted mt-1 hidden"
          >
            No active sessions available. Create a session first.
          </p>
        </div>

        <!-- Settings List -->
        <div id="settings-list" class="space-y-3 hidden">
          <!-- Always Online -->
          <div
            class="flex items-center justify-between p-3 bg-gh-bg-secondary rounded-gh"
          >
            <div class="flex items-center gap-3">
              <svg
                class="w-5 h-5 text-gh-success"
                viewBox="0 0 16 16"
                fill="currentColor"
              >
                <path
                  d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5ZM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0Z"
                ></path>
                <path
                  d="M8 0a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0Zm0 13a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 8 13ZM.75 7.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H.75Zm12.5 0a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5h-1.5ZM2.343 2.343a.75.75 0 0 1 1.061 0l1.06 1.061a.75.75 0 0 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06Zm9.193 9.193a.75.75 0 0 1 1.06 0l1.061 1.06a.75.75 0 0 1-1.06 1.061l-1.061-1.06a.75.75 0 0 1 0-1.061ZM2.343 13.657a.75.75 0 0 1 0-1.061l1.06-1.06a.75.75 0 0 1 1.061 1.06l-1.06 1.06a.75.75 0 0 1-1.06 0Zm9.193-9.193a.75.75 0 0 1 0-1.06l1.061-1.061a.75.75 0 1 1 1.06 1.06l-1.06 1.061a.75.75 0 0 1-1.06 0Z"
                ></path>
              </svg>
              <span class="text-sm font-medium text-gh-text">Always Online</span
              >
            </div>
            <button
              id="toggle-auto_always_online"
              class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gh-accent focus:ring-offset-2 bg-gh-bg-tertiary"
              role="switch"
              aria-checked="false"
              data-setting="auto_always_online"
            >
              <span
                class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out translate-x-0"
              ></span>
            </button>
          </div>

          <!-- Typing Indicator -->
          <div
            class="flex items-center justify-between p-3 bg-gh-bg-secondary rounded-gh"
          >
            <div class="flex items-center gap-3">
              <svg
                class="w-5 h-5 text-gh-accent"
                viewBox="0 0 16 16"
                fill="currentColor"
              >
                <path
                  d="M1.75 1h8.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 10.25 10H7.061l-2.574 2.573A1.458 1.458 0 0 1 2 11.543V10h-.25A1.75 1.75 0 0 1 0 8.25v-5.5C0 1.784.784 1 1.75 1ZM1.5 2.75v5.5c0 .138.112.25.25.25h1a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h3.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13 2a.25.25 0 0 0-.25-.25h-.5a.75.75 0 0 1 0-1.5h.5c.966 0 1.75.784 1.75 1.75v5.5a1.75 1.75 0 0 1-1.75 1.75H14v1.543a1.458 1.458 0 0 1-2.487 1.03L9.22 11.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.22 2.22v-2.19a.75.75 0 0 1 .75-.75h1a.25.25 0 0 0 .25-.25Z"
                ></path>
              </svg>
              <span class="text-sm font-medium text-gh-text"
                >Typing Indicator</span
              >
            </div>
            <button
              id="toggle-auto_typing"
              class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gh-accent focus:ring-offset-2 bg-gh-bg-tertiary"
              role="switch"
              aria-checked="false"
              data-setting="auto_typing"
            >
              <span
                class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out translate-x-0"
              ></span>
            </button>
          </div>

          <!-- Recording Indicator -->
          <div
            class="flex items-center justify-between p-3 bg-gh-bg-secondary rounded-gh"
          >
            <div class="flex items-center gap-3">
              <svg
                class="w-5 h-5 text-gh-danger"
                viewBox="0 0 16 16"
                fill="currentColor"
              >
                <path
                  d="M8 1a.75.75 0 0 1 .75.75v6.5a.75.75 0 0 1-1.5 0v-6.5A.75.75 0 0 1 8 1ZM3.5 8a.75.75 0 0 1 .75.75v1.5a3.75 3.75 0 1 0 7.5 0v-1.5a.75.75 0 0 1 1.5 0v1.5a5.25 5.25 0 1 1-10.5 0v-1.5A.75.75 0 0 1 3.5 8Z"
                ></path>
              </svg>
              <span class="text-sm font-medium text-gh-text"
                >Recording Indicator</span
              >
            </div>
            <button
              id="toggle-auto_recording"
              class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gh-accent focus:ring-offset-2 bg-gh-bg-tertiary"
              role="switch"
              aria-checked="false"
              data-setting="auto_recording"
            >
              <span
                class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out translate-x-0"
              ></span>
            </button>
          </div>

          <!-- Auto Read Messages -->
          <div
            class="flex items-center justify-between p-3 bg-gh-bg-secondary rounded-gh"
          >
            <div class="flex items-center gap-3">
              <svg
                class="w-5 h-5 text-gh-link"
                viewBox="0 0 16 16"
                fill="currentColor"
              >
                <path
                  d="M1.75 2h12.5c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0 1 14.25 14H1.75A1.75 1.75 0 0 1 0 12.25v-8.5C0 2.784.784 2 1.75 2ZM1.5 12.251c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V5.809L8.38 9.397a.75.75 0 0 1-.76 0L1.5 5.809v6.442Zm13-8.181v-.32a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25v.32L8 7.88Z"
                ></path>
              </svg>
              <span class="text-sm font-medium text-gh-text"
                >Auto Read Messages</span
              >
            </div>
            <button
              id="toggle-auto_read_messages"
              class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gh-accent focus:ring-offset-2 bg-gh-bg-tertiary"
              role="switch"
              aria-checked="false"
              data-setting="auto_read_messages"
            >
              <span
                class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out translate-x-0"
              ></span>
            </button>
          </div>

          <!-- Auto Reject Calls -->
          <div
            class="flex items-center justify-between p-3 bg-gh-bg-secondary rounded-gh"
          >
            <div class="flex items-center gap-3">
              <svg
                class="w-5 h-5 text-gh-danger"
                viewBox="0 0 16 16"
                fill="currentColor"
              >
                <path
                  d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328ZM1.884.511a2.178 2.178 0 0 1 3.26.202l1.794 2.307a2.178 2.178 0 0 1 .39 1.86l-.548 2.19c-.031.127.008.265.104.36l2.457 2.457a.263.263 0 0 0 .36.104l2.19-.547a2.178 2.178 0 0 1 1.86.388l2.307 1.794a2.178 2.178 0 0 1 .202 3.26l-1.034 1.034c-.74.74-1.847 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.363-1.03-.038-2.136.702-2.877L1.884.511Z"
                ></path>
                <path
                  d="M11.5 3.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V4.707l-2.646 2.647a.5.5 0 0 1-.708-.708L13.793 4H12.5a.5.5 0 0 1-.5-.5Z"
                ></path>
              </svg>
              <span class="text-sm font-medium text-gh-text"
                >Auto Reject Calls</span
              >
            </div>
            <button
              id="toggle-auto_reject_calls"
              class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gh-accent focus:ring-offset-2 bg-gh-bg-tertiary"
              role="switch"
              aria-checked="false"
              data-setting="auto_reject_calls"
            >
              <span
                class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out translate-x-0"
              ></span>
            </button>
          </div>

          <!-- Auto Recover Deleted Messages -->
          <div
            class="flex items-center justify-between p-3 bg-gh-bg-secondary rounded-gh"
          >
            <div class="flex items-center gap-3">
              <svg
                class="w-5 h-5 text-gh-warning"
                viewBox="0 0 16 16"
                fill="currentColor"
              >
                <path
                  d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864 1.858-.282.842-1.68 1.337-1.32L13.4 6l.306-1.854-1.337-1.32-.842-1.68L9.669.864zm1.196 1.193.684 1.365 1.086 1.072L12.387 6l.248 1.506-1.086 1.072-.684 1.365-1.51.229L8 10.874l-1.355-.702-1.51-.229-.684-1.365-1.086-1.072L3.613 6l-.248-1.506 1.086-1.072.684-1.365 1.51-.229L8 1.126l1.356.702 1.509.229z"
                ></path>
                <path
                  d="M4 11.794V16l4-1 4 1v-4.206l-2.018.306L8 13.126 6.018 12.1 4 11.794z"
                ></path>
              </svg>
              <span class="text-sm font-medium text-gh-text"
                >Auto Recover Deleted</span
              >
            </div>
            <button
              id="toggle-auto_recover_deleted_messages"
              class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gh-accent focus:ring-offset-2 bg-gh-bg-tertiary"
              role="switch"
              aria-checked="false"
              data-setting="auto_recover_deleted_messages"
            >
              <span
                class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out translate-x-0"
              ></span>
            </button>
          </div>

          <!-- Auto Anti-Spam -->
          <div
            class="flex items-center justify-between p-3 bg-gh-bg-secondary rounded-gh"
          >
            <div class="flex items-center gap-3">
              <svg
                class="w-5 h-5 text-gh-done"
                viewBox="0 0 16 16"
                fill="currentColor"
              >
                <path
                  d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"
                ></path>
              </svg>
              <span class="text-sm font-medium text-gh-text"
                >Auto Anti-Spam</span
              >
            </div>
            <button
              id="toggle-auto_antispam"
              class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gh-accent focus:ring-offset-2 bg-gh-bg-tertiary"
              role="switch"
              aria-checked="false"
              data-setting="auto_antispam"
            >
              <span
                class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out translate-x-0"
              ></span>
            </button>
          </div>
        </div>

        <!-- Loading State -->
        <div id="settings-loading" class="hidden text-center py-8">
          <div class="space-y-3 max-w-xs mx-auto">
            <div class="h-6 bg-gh-bg-tertiary rounded-gh animate-ghost-pulse">
            </div>
            <div
              class="h-6 bg-gh-bg-tertiary rounded-gh animate-ghost-pulse w-4/5 mx-auto"
            >
            </div>
            <div
              class="h-6 bg-gh-bg-tertiary rounded-gh animate-ghost-pulse w-3/5 mx-auto"
            >
            </div>
          </div>
          <p class="text-sm text-gh-text-muted mt-4">Loading settings...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirm-modal" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-black/50" id="confirm-modal-backdrop"></div>
    <div
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm bg-gh-bg border border-gh-border rounded-gh shadow-xl"
    >
      <div class="p-4 border-b border-gh-border">
        <h2 id="confirm-modal-title" class="text-sm font-semibold text-gh-text">
          Confirm Action
        </h2>
      </div>
      <div class="p-4">
        <p
          id="confirm-modal-message"
          class="text-sm text-gh-text-secondary mb-4"
        >
          Are you sure you want to proceed?
        </p>
        <div class="flex gap-2">
          <button
            id="confirm-modal-cancel"
            class="flex-1 py-1.5 px-4 text-sm font-medium rounded-gh bg-gh-bg-secondary border border-gh-border text-gh-text hover:bg-gh-bg-tertiary transition-colors"
          >
            Cancel
          </button>
          <button
            id="confirm-modal-continue"
            class="flex-1 py-1.5 px-4 text-sm font-medium rounded-gh bg-gh-danger text-white hover:bg-red-700 transition-colors"
          >
            Continue
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Info Modal -->
  <div id="info-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50" id="info-modal-backdrop"></div>
    <div
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg bg-gh-bg border border-gh-border rounded-gh shadow-xl max-h-[90vh] flex flex-col"
    >
      <div
        class="p-4 border-b border-gh-border flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <svg
            class="w-4 h-4 text-gh-accent"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"
            ></path>
          </svg>
          <h2 class="text-sm font-semibold text-gh-text">System Information</h2>
        </div>
        <button
          id="close-info-modal"
          class="p-1 text-gh-text-secondary hover:text-gh-text transition-colors"
        >
          <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"
            ></path>
          </svg>
        </button>
      </div>
      <div class="p-4 overflow-y-auto flex-1 space-y-4">
        <!-- Runtime Section -->
        <div class="bg-gh-bg-secondary rounded-gh p-3">
          <h3
            class="text-xs font-semibold text-gh-text-muted uppercase tracking-wider mb-2"
          >
            Runtime
          </h3>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Runtime</span>
              <span id="info-runtime" class="text-sm font-mono text-gh-text"
                >Bun</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Version</span>
              <span
                id="info-runtime-version"
                class="text-sm font-mono text-gh-text">-</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Platform</span>
              <span id="info-platform" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Architecture</span>
              <span id="info-arch" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
          </div>
        </div>

        <!-- Browser Section -->
        <div class="bg-gh-bg-secondary rounded-gh p-3">
          <h3
            class="text-xs font-semibold text-gh-text-muted uppercase tracking-wider mb-2"
          >
            Browser
          </h3>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Browser</span>
              <span id="info-browser" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Language</span>
              <span id="info-language" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Screen</span>
              <span id="info-screen" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Online</span>
              <span id="info-online" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
          </div>
        </div>

        <!-- Application Section -->
        <div class="bg-gh-bg-secondary rounded-gh p-3">
          <h3
            class="text-xs font-semibold text-gh-text-muted uppercase tracking-wider mb-2"
          >
            Application
          </h3>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">App Version</span>
              <span id="info-app-version" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Bot Name</span>
              <span id="info-bot-name" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Sessions</span>
              <span id="info-sessions" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Active</span>
              <span id="info-active" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
          </div>
        </div>

        <!-- Connection Section -->
        <div class="bg-gh-bg-secondary rounded-gh p-3">
          <h3
            class="text-xs font-semibold text-gh-text-muted uppercase tracking-wider mb-2"
          >
            Connection
          </h3>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Page URL</span>
              <span
                id="info-url"
                class="text-sm font-mono text-gh-text truncate max-w-[200px]"
                >-</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gh-text-secondary">Timestamp</span>
              <span id="info-timestamp" class="text-sm font-mono text-gh-text"
                >-</span
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Report Modal -->
  <div id="report-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50" id="report-modal-backdrop"></div>
    <div
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg bg-gh-bg border border-gh-border rounded-gh shadow-xl max-h-[90vh] flex flex-col"
    >
      <div
        class="p-4 border-b border-gh-border flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <svg
            class="w-4 h-4 text-gh-warning"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"
            ></path>
          </svg>
          <h2 class="text-sm font-semibold text-gh-text">Submit Report</h2>
        </div>
        <button
          id="close-report-modal"
          class="p-1 text-gh-text-secondary hover:text-gh-text transition-colors"
        >
          <svg class="w-5 h-5" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"
            ></path>
          </svg>
        </button>
      </div>
      <div class="p-4 overflow-y-auto flex-1">
        <form id="report-form" class="space-y-4">
          <!-- Report Type -->
          <div>
            <label
              for="report-type"
              class="block text-sm font-medium text-gh-text mb-1"
            >
              Report Type
            </label>
            <select
              id="report-type"
              required
              class="w-full px-3 py-1.5 text-sm bg-gh-bg border border-gh-border rounded-gh text-gh-text focus:outline-none focus:border-gh-accent focus:ring-1 focus:ring-gh-accent"
            >
              <option value="">-- Select type --</option>
              <option value="bug">Bug Report</option>
              <option value="feature">Feature Request</option>
              <option value="other">Other</option>
            </select>
          </div>

          <!-- Message -->
          <div>
            <label
              for="report-message"
              class="block text-sm font-medium text-gh-text mb-1"
            >
              Message <span class="text-gh-text-muted font-normal"
                >(min. 15 words)</span
              >
            </label>
            <textarea
              id="report-message"
              required
              rows="5"
              placeholder="Please describe your report in detail..."
              class="w-full px-3 py-1.5 text-sm bg-gh-bg border border-gh-border rounded-gh text-gh-text placeholder-gh-text-muted focus:outline-none focus:border-gh-accent focus:ring-1 focus:ring-gh-accent resize-none"
            ></textarea>
            <p id="report-word-count" class="text-xs text-gh-text-muted mt-1">
              0 words
            </p>
          </div>

          <!-- Image Upload (Optional) -->
          <div>
            <label
              for="report-image"
              class="block text-sm font-medium text-gh-text mb-1"
            >
              Attachment <span class="text-gh-text-muted font-normal"
                >(optional)</span
              >
            </label>
            <input
              type="file"
              id="report-image"
              accept="image/*"
              class="w-full text-sm text-gh-text-secondary file:mr-4 file:py-1.5 file:px-3 file:rounded-gh file:border file:border-gh-border file:text-sm file:font-medium file:bg-gh-bg-secondary file:text-gh-text hover:file:bg-gh-bg-tertiary file:cursor-pointer"
            />
            <p class="text-xs text-gh-text-muted mt-1">Max 5MB, images only</p>
          </div>

          <!-- Warning Notice -->
          <div
            class="p-3 rounded-gh bg-gh-warning-subtle border border-gh-warning"
          >
            <div class="flex gap-2">
              <svg
                class="w-4 h-4 text-gh-warning flex-shrink-0 mt-0.5"
                viewBox="0 0 16 16"
                fill="currentColor"
              >
                <path
                  d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"
                ></path>
              </svg>
              <div>
                <p class="text-xs font-medium text-gh-warning">
                  Privacy Warning
                </p>
                <p class="text-xs text-gh-text-secondary mt-0.5">
                  Do not include sensitive or personal information in your
                  report. Sending private data may result in being blocked from
                  support access.
                </p>
              </div>
            </div>
          </div>

          <!-- Error Message -->
          <div
            id="report-error-message"
            class="p-3 rounded-gh bg-gh-danger-subtle border border-gh-danger text-gh-danger text-sm hidden"
          >
          </div>

          <!-- Actions -->
          <div class="flex gap-2 pt-2">
            <button
              type="button"
              id="report-cancel"
              class="flex-1 py-1.5 px-4 text-sm font-medium rounded-gh bg-gh-bg-secondary border border-gh-border text-gh-text hover:bg-gh-bg-tertiary transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              id="report-send"
              class="flex-1 py-1.5 px-4 text-sm font-medium rounded-gh bg-gh-accent text-white hover:bg-gh-accent-emphasis transition-colors"
            >
              Send
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <main class="max-w-4xl mx-auto px-4 py-8 lg:ml-20 pb-24 lg:pb-8">
    <div class="grid grid-cols-4 gap-4 mb-8"></div>
    <!-- Quick Stats -->
    <div class="grid grid-cols-3 gap-4 mb-8">
      <div class="bg-gh-bg border border-gh-border rounded-gh p-4 text-center">
        <div class="flex justify-center mb-2">
          <svg
            class="w-5 h-5 text-gh-text-secondary"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.508 5.508 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4 4 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.493 3.493 0 0 1 2 5.5ZM11 4a3.001 3.001 0 0 1 2.22 5.018 5.01 5.01 0 0 1 2.56 3.012.749.749 0 0 1-.885.954.752.752 0 0 1-.549-.514 3.507 3.507 0 0 0-2.522-2.372.75.75 0 0 1-.574-.73v-.352a.75.75 0 0 1 .416-.672A1.5 1.5 0 0 0 11 5.5.75.75 0 0 1 11 4Zm-5.5-.5a2 2 0 1 0-.001 3.999A2 2 0 0 0 5.5 3.5Z"
            ></path>
          </svg>
        </div>
        <p id="stat-sessions" class="text-lg font-semibold text-gh-text">0</p>
        <p class="text-xs text-gh-text-muted">Sessions</p>
      </div>
      <div class="bg-gh-bg border border-gh-border rounded-gh p-4 text-center">
        <div class="flex justify-center mb-2">
          <svg
            class="w-5 h-5 text-gh-success"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 0 1 1.06-1.06L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"
            ></path>
          </svg>
        </div>
        <p id="stat-active" class="text-lg font-semibold text-gh-success">0</p>
        <p class="text-xs text-gh-text-muted">Active</p>
      </div>
      <div class="bg-gh-bg border border-gh-border rounded-gh p-4 text-center">
        <div class="flex justify-center mb-2">
          <svg
            class="w-5 h-5 text-gh-text-secondary"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M1.75 1h8.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 10.25 10H7.061l-2.574 2.573A1.458 1.458 0 0 1 2 11.543V10h-.25A1.75 1.75 0 0 1 0 8.25v-5.5C0 1.784.784 1 1.75 1Z"
            ></path>
          </svg>
        </div>
        <p id="stat-messages" class="text-lg font-semibold text-gh-text">0</p>
        <p class="text-xs text-gh-text-muted">Messages</p>
      </div>
    </div>

    <!-- Memory Usage Section -->
    <div class="bg-gh-bg border border-gh-border rounded-gh mb-8">
      <div
        class="p-4 border-b border-gh-border flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <svg
            class="w-4 h-4 text-gh-text-secondary"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M14.25 1c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1ZM1.5 2.75v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25Zm5.5 2h2.25v6.5H7Zm3.75 3h2.25v3.5h-2.25ZM4 6.75v4.5h2.25v-4.5Z"
            ></path>
          </svg>
          <h2 class="text-sm font-semibold text-gh-text">Memory Usage</h2>
          <span id="memory-current" class="text-xs text-gh-text-muted">--</span>
        </div>
        <div class="flex items-center gap-1 bg-gh-bg-secondary rounded-gh p-0.5">
          <button
            id="memory-range-1m"
            class="px-2 py-0.5 text-xs font-medium rounded text-gh-text bg-gh-bg-tertiary transition-colors"
            data-range="60"
          >
            1m
          </button>
          <button
            id="memory-range-5m"
            class="px-2 py-0.5 text-xs font-medium rounded text-gh-text-secondary hover:text-gh-text hover:bg-gh-bg-tertiary transition-colors"
            data-range="300"
          >
            5m
          </button>
          <button
            id="memory-range-15m"
            class="px-2 py-0.5 text-xs font-medium rounded text-gh-text-secondary hover:text-gh-text hover:bg-gh-bg-tertiary transition-colors"
            data-range="900"
          >
            15m
          </button>
          <button
            id="memory-range-1h"
            class="px-2 py-0.5 text-xs font-medium rounded text-gh-text-secondary hover:text-gh-text hover:bg-gh-bg-tertiary transition-colors"
            data-range="3600"
          >
            1h
          </button>
        </div>
      </div>
      <div class="p-4 relative">
        <!-- Custom tooltip for memory chart -->
        <div
          id="memory-tooltip"
          class="absolute z-10 px-2 py-1 text-xs font-medium text-gh-text bg-gh-bg-secondary border border-gh-border rounded-gh shadow-lg pointer-events-none opacity-0 transition-opacity duration-150"
          style="transform: translateX(-50%);"
        >
        </div>
        <!-- Memory line chart container -->
        <div id="memory-chart" class="h-32 relative">
          <!-- SVG chart will be rendered here -->
          <svg
            id="memory-chart-svg"
            class="w-full h-full"
            viewBox="0 0 400 128"
            preserveAspectRatio="none"
          >
            <!-- Grid lines -->
            <g id="memory-grid" class="text-gh-border">
              <line x1="0" y1="32" x2="400" y2="32" stroke="currentColor" stroke-opacity="0.3" stroke-dasharray="4,4"></line>
              <line x1="0" y1="64" x2="400" y2="64" stroke="currentColor" stroke-opacity="0.3" stroke-dasharray="4,4"></line>
              <line x1="0" y1="96" x2="400" y2="96" stroke="currentColor" stroke-opacity="0.3" stroke-dasharray="4,4"></line>
            </g>
            <!-- Gradient fill under the line -->
            <defs>
              <linearGradient id="memoryGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:var(--gh-success);stop-opacity:0.3" />
                <stop offset="100%" style="stop-color:var(--gh-success);stop-opacity:0.05" />
              </linearGradient>
            </defs>
            <!-- Area fill -->
            <path
              id="memory-area"
              fill="url(#memoryGradient)"
              d=""
            ></path>
            <!-- Memory usage line (smooth curve) -->
            <path
              id="memory-line"
              fill="none"
              stroke="var(--gh-success)"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              d=""
            ></path>
            <!-- Data points -->
            <g id="memory-dots"></g>
          </svg>
          <!-- Loading skeleton -->
          <div id="memory-skeleton" class="absolute inset-0 flex items-center justify-center">
            <div class="w-full h-16 bg-gh-bg-tertiary rounded animate-ghost-pulse"></div>
          </div>
        </div>
        <!-- Y-axis labels -->
        <div class="absolute left-0 top-4 bottom-8 flex flex-col justify-between text-xs text-gh-text-muted pointer-events-none">
          <span id="memory-max-label">--</span>
          <span id="memory-mid-label">--</span>
          <span id="memory-min-label">0 MB</span>
        </div>
        <!-- Time labels -->
        <div class="flex justify-between text-xs text-gh-text-muted mt-2 px-1">
          <span id="memory-time-start">--</span>
          <span id="memory-time-end">Now</span>
        </div>
        <!-- Memory stats -->
        <div id="memory-stats" class="flex items-center gap-4 text-xs mt-2 pt-2 border-t border-gh-border">
          <span class="text-gh-text-secondary">
            Peak: <span id="memory-peak" class="text-gh-text font-medium">--</span>
          </span>
          <span class="text-gh-text-secondary">
            Avg: <span id="memory-avg" class="text-gh-text font-medium">--</span>
          </span>
          <span class="text-gh-text-secondary">
            Used: <span id="memory-used" class="text-gh-text font-medium">--</span>
          </span>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Create Session Card -->
      <div class="bg-gh-bg border border-gh-border rounded-gh">
        <div
          class="p-4 border-b border-gh-border flex items-center justify-between cursor-pointer hover:bg-gh-bg-secondary transition-colors"
          id="new-session-header"
        >
          <div class="flex items-center gap-2">
            <svg
              class="w-4 h-4 text-gh-text-secondary"
              viewBox="0 0 16 16"
              fill="currentColor"
            >
              <path
                d="M7.75 2a.75.75 0 0 1 .75.75V7h4.25a.75.75 0 0 1 0 1.5H8.5v4.25a.75.75 0 0 1-1.5 0V8.5H2.75a.75.75 0 0 1 0-1.5H7V2.75A.75.75 0 0 1 7.75 2Z"
              ></path>
            </svg>
            <h2 class="text-sm font-semibold text-gh-text">New Session</h2>
          </div>
          <svg
            id="new-session-chevron"
            class="w-4 h-4 text-gh-text-secondary transition-transform"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M12.78 5.22a.749.749 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.06 0L3.22 6.28a.749.749 0 1 1 1.06-1.06L8 8.939l3.72-3.719a.749.749 0 0 1 1.06 0Z"
            ></path>
          </svg>
        </div>

        <div id="new-session-content">
          <!-- Collapsed State -->
          <div id="form-collapsed" class="p-6 text-center">
            <p class="text-sm text-gh-text-secondary mb-4">
              Create a new WhatsApp session to get started
            </p>
            <button
              id="show-form-btn"
              class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-gh bg-gh-success text-white hover:bg-green-700 transition-colors"
            >
              <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor">
                <path
                  d="M7.75 2a.75.75 0 0 1 .75.75V7h4.25a.75.75 0 0 1 0 1.5H8.5v4.25a.75.75 0 0 1-1.5 0V8.5H2.75a.75.75 0 0 1 0-1.5H7V2.75A.75.75 0 0 1 7.75 2Z"
                ></path>
              </svg>
              Create Session
            </button>
          </div>

          <!-- Expanded Form -->
          <form id="session-form" class="p-4 space-y-4 hidden">
            <div>
              <label
                for="phone"
                class="block text-sm font-medium text-gh-text mb-1"
              >
                <span class="flex items-center gap-2">
                  <svg
                    class="w-4 h-4 text-gh-text-secondary"
                    viewBox="0 0 16 16"
                    fill="currentColor"
                  >
                    <path
                      d="M10.561 8.073a6.005 6.005 0 0 1 3.432 5.142.75.75 0 1 1-1.498.07 4.5 4.5 0 0 0-8.99 0 .75.75 0 0 1-1.498-.07 6.004 6.004 0 0 1 3.431-5.142 3.999 3.999 0 1 1 5.123 0ZM10.5 5a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"
                    ></path>
                  </svg>
                  Phone Number
                </span>
              </label>
              <input
                type="tel"
                id="phone"
                name="phoneNumber"
                placeholder="14155551234"
                required
                pattern="[0-9]+"
                class="w-full px-3 py-1.5 text-sm bg-gh-bg border border-gh-border rounded-gh text-gh-text placeholder-gh-text-muted focus:outline-none focus:border-gh-accent focus:ring-1 focus:ring-gh-accent"
              />
              <p class="text-xs text-gh-text-muted mt-1">
                Include country code without + symbol
              </p>
            </div>

            <div>
              <label
                for="botName"
                class="block text-sm font-medium text-gh-text mb-1"
              >
                <span class="flex items-center gap-2">
                  <svg
                    class="w-4 h-4 text-gh-text-secondary"
                    viewBox="0 0 16 16"
                    fill="currentColor"
                  >
                    <path
                      d="M11.93 8.5a4.002 4.002 0 0 1-7.86 0H.75a.75.75 0 0 1 0-1.5h3.32a4.002 4.002 0 0 1 7.86 0h3.32a.75.75 0 0 1 0 1.5Zm-1.43-.75a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"
                    ></path>
                  </svg>
                  Bot Name
                  <span class="text-gh-text-muted font-normal">(optional)</span>
                </span>
              </label>
              <div class="relative">
                <input
                  type="text"
                  id="botName"
                  name="botName"
                  placeholder="My Bot"
                  class="w-full px-3 py-1.5 pr-8 text-sm bg-gh-bg border border-gh-border rounded-gh text-gh-text placeholder-gh-text-muted focus:outline-none focus:border-gh-accent focus:ring-1 focus:ring-gh-accent"
                />
                <button
                  type="button"
                  id="clear-botname"
                  class="absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gh-text-muted hover:text-gh-danger transition-colors hidden"
                  data-tooltip="Clear"
                >
                  <svg
                    class="w-3.5 h-3.5"
                    viewBox="0 0 16 16"
                    fill="currentColor"
                  >
                    <path
                      d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"
                    ></path>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Custom Variables -->
            <div>
              <div class="flex items-center justify-between mb-1">
                <label class="block text-sm font-medium text-gh-text">
                  <span class="flex items-center gap-2">
                    <svg
                      class="w-4 h-4 text-gh-text-secondary"
                      viewBox="0 0 16 16"
                      fill="currentColor"
                    >
                      <path
                        d="M0 1.75A.75.75 0 0 1 .75 1h4.253c1.227 0 2.317.59 3 1.501A3.743 3.743 0 0 1 11.006 1h4.245a.75.75 0 0 1 .75.75v10.5a.75.75 0 0 1-.75.75h-4.507a2.25 2.25 0 0 0-1.591.659l-.622.621a.75.75 0 0 1-1.06 0l-.622-.621A2.25 2.25 0 0 0 5.258 13H.75a.75.75 0 0 1-.75-.75Z"
                      ></path>
                    </svg>
                    Custom Variables
                    <span class="text-gh-text-muted font-normal"
                      >(optional)</span
                    >
                  </span>
                </label>
                <button
                  type="button"
                  id="add-var-btn"
                  class="text-xs text-gh-link hover:underline flex items-center gap-1"
                >
                  <svg class="w-3 h-3" viewBox="0 0 16 16" fill="currentColor">
                    <path
                      d="M7.75 2a.75.75 0 0 1 .75.75V7h4.25a.75.75 0 0 1 0 1.5H8.5v4.25a.75.75 0 0 1-1.5 0V8.5H2.75a.75.75 0 0 1 0-1.5H7V2.75A.75.75 0 0 1 7.75 2Z"
                    ></path>
                  </svg>
                  Add
                </button>
              </div>
              <div id="custom-vars" class="space-y-2">
                <!-- Custom variables will be added here -->
              </div>
            </div>

            <div class="flex gap-2">
              <button
                type="button"
                id="cancel-form-btn"
                class="flex-1 py-1.5 px-4 text-sm font-medium rounded-gh bg-gh-bg-secondary border border-gh-border text-gh-text hover:bg-gh-bg-tertiary transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="flex-1 py-1.5 px-4 text-sm font-medium rounded-gh bg-gh-success text-white hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                Create Session
              </button>
            </div>
          </form>

          <div
            id="error-message"
            class="mx-4 mb-4 p-3 rounded-gh bg-gh-danger-subtle border border-gh-danger text-gh-danger text-sm hidden"
          >
          </div>
        </div>
        <!-- End new-session-content -->
      </div>
    </div>

    <!-- Existing Sessions -->
    <div class="mt-6 bg-gh-bg border border-gh-border rounded-gh">
      <div
        class="p-4 border-b border-gh-border flex items-center justify-between cursor-pointer hover:bg-gh-bg-secondary transition-colors"
        id="sessions-header"
      >
        <div class="flex items-center gap-2">
          <svg
            class="w-4 h-4 text-gh-text-secondary"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M0 1.75A.75.75 0 0 1 .75 1h4.253c1.227 0 2.317.59 3 1.501A3.743 3.743 0 0 1 11.006 1h4.245a.75.75 0 0 1 .75.75v10.5a.75.75 0 0 1-.75.75h-4.507a2.25 2.25 0 0 0-1.591.659l-.622.621a.75.75 0 0 1-1.06 0l-.622-.621A2.25 2.25 0 0 0 5.258 13H.75a.75.75 0 0 1-.75-.75Zm7.251 10.324.004-5.073-.002-2.253A2.25 2.25 0 0 0 5.003 2.5H1.5v9h3.757a3.75 3.75 0 0 1 1.994.574ZM8.755 4.75l-.004 7.322a3.752 3.752 0 0 1 1.992-.572H14.5v-9h-3.495a2.25 2.25 0 0 0-2.25 2.25Z"
            ></path>
          </svg>
          <h2 class="text-sm font-semibold text-gh-text">Sessions</h2>
          <span id="session-count" class="text-xs text-gh-text-muted"
            >Loading...</span
          >
        </div>
        <div class="flex items-center gap-2">
          <svg
            id="sessions-chevron"
            class="w-4 h-4 text-gh-text-secondary transition-transform"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path
              d="M12.78 5.22a.749.749 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.06 0L3.22 6.28a.749.749 0 1 1 1.06-1.06L8 8.939l3.72-3.719a.749.749 0 0 1 1.06 0Z"
            ></path>
          </svg>
        </div>
      </div>
      <div id="sessions-list" class="divide-y divide-gh-border">
        <!-- Ghost loaders -->
        <div class="flex items-center justify-between p-3">
          <div class="flex items-center gap-3">
            <div class="w-4 h-4 bg-gh-bg-tertiary rounded animate-ghost-pulse">
            </div>
            <div class="w-32 h-4 bg-gh-bg-tertiary rounded animate-ghost-pulse">
            </div>
          </div>
          <div class="flex items-center gap-1">
            <div class="w-8 h-8 bg-gh-bg-tertiary rounded animate-ghost-pulse">
            </div>
            <div class="w-8 h-8 bg-gh-bg-tertiary rounded animate-ghost-pulse">
            </div>
          </div>
        </div>
        <div class="flex items-center justify-between p-3">
          <div class="flex items-center gap-3">
            <div class="w-4 h-4 bg-gh-bg-tertiary rounded animate-ghost-pulse">
            </div>
            <div class="w-24 h-4 bg-gh-bg-tertiary rounded animate-ghost-pulse">
            </div>
          </div>
          <div class="flex items-center gap-1">
            <div class="w-8 h-8 bg-gh-bg-tertiary rounded animate-ghost-pulse">
            </div>
            <div class="w-8 h-8 bg-gh-bg-tertiary rounded animate-ghost-pulse">
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script>
  import { api } from "../lib/api";

  const form = document.getElementById("session-form") as HTMLFormElement;
  const formCollapsed = document.getElementById(
    "form-collapsed"
  ) as HTMLDivElement;
  const errorDiv = document.getElementById("error-message") as HTMLDivElement;
  const sessionsList = document.getElementById(
    "sessions-list"
  ) as HTMLDivElement;
  const sessionCount = document.getElementById(
    "session-count"
  ) as HTMLSpanElement;
  const showFormBtn = document.getElementById(
    "show-form-btn"
  ) as HTMLButtonElement;
  const cancelFormBtn = document.getElementById(
    "cancel-form-btn"
  ) as HTMLButtonElement;
  const botNameInput = document.getElementById("botName") as HTMLInputElement;
  const clearBotnameBtn = document.getElementById(
    "clear-botname"
  ) as HTMLButtonElement;
  const customVarsContainer = document.getElementById(
    "custom-vars"
  ) as HTMLDivElement;
  const addVarBtn = document.getElementById("add-var-btn") as HTMLButtonElement;

  let formExpanded = false;
  let sessionsLoaded = false;
  let varCounter = 0;

  // Confirmation modal elements and functions (defined early so they can be used by deleteSession)
  const confirmModal = document.getElementById("confirm-modal");
  const confirmModalBackdrop = document.getElementById(
    "confirm-modal-backdrop"
  );
  const confirmModalTitle = document.getElementById("confirm-modal-title");
  const confirmModalMessage = document.getElementById("confirm-modal-message");
  const confirmModalCancel = document.getElementById("confirm-modal-cancel");
  const confirmModalContinue = document.getElementById(
    "confirm-modal-continue"
  );

  type ConfirmCallback = () => void;
  let pendingConfirmCallback: ConfirmCallback | null = null;

  function showConfirmModal(
    title: string,
    message: string,
    onConfirm: ConfirmCallback
  ) {
    if (confirmModalTitle) confirmModalTitle.textContent = title;
    if (confirmModalMessage) confirmModalMessage.textContent = message;
    pendingConfirmCallback = onConfirm;
    confirmModal?.classList.remove("hidden");
  }

  function hideConfirmModal() {
    confirmModal?.classList.add("hidden");
    pendingConfirmCallback = null;
  }

  confirmModalCancel?.addEventListener("click", hideConfirmModal);
  confirmModalBackdrop?.addEventListener("click", hideConfirmModal);

  confirmModalContinue?.addEventListener("click", () => {
    if (pendingConfirmCallback) {
      pendingConfirmCallback();
    }
    hideConfirmModal();
  });

  function addCustomVar(name = "", value = "") {
    const varId = ++varCounter;
    const varHtml = `
      <div class="flex gap-2 items-center" data-var-id="${varId}">
        <input 
          type="text" 
          placeholder="Key" 
          value="${name}"
          class="flex-1 px-3 py-1.5 text-sm bg-gh-bg border border-gh-border rounded-gh text-gh-text placeholder-gh-text-muted focus:outline-none focus:border-gh-accent focus:ring-1 focus:ring-gh-accent"
          data-var-key="${varId}"
        />
        <input 
          type="text" 
          placeholder="Value" 
          value="${value}"
          class="flex-1 px-3 py-1.5 text-sm bg-gh-bg border border-gh-border rounded-gh text-gh-text placeholder-gh-text-muted focus:outline-none focus:border-gh-accent focus:ring-1 focus:ring-gh-accent"
          data-var-value="${varId}"
        />
        <button type="button" class="p-1.5 text-gh-text-muted hover:text-gh-danger transition-colors" data-remove-var="${varId}" data-tooltip="Remove">
          <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor">
            <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"/>
          </svg>
        </button>
      </div>
    `;
    customVarsContainer.insertAdjacentHTML("beforeend", varHtml);

    // Add event listener for remove button
    const removeBtn = customVarsContainer.querySelector(
      `[data-remove-var="${varId}"]`
    );
    removeBtn?.addEventListener("click", () => removeCustomVar(varId));
  }

  function removeCustomVar(varId: number) {
    const varEl = customVarsContainer.querySelector(`[data-var-id="${varId}"]`);
    varEl?.remove();
  }

  function getCustomVars(): Record<string, string> {
    const vars: Record<string, string> = {};
    const varElements = customVarsContainer.querySelectorAll("[data-var-id]");
    varElements.forEach((el) => {
      const varId = el.getAttribute("data-var-id");
      const keyInput = el.querySelector(
        `[data-var-key="${varId}"]`
      ) as HTMLInputElement;
      const valueInput = el.querySelector(
        `[data-var-value="${varId}"]`
      ) as HTMLInputElement;
      if (keyInput?.value && valueInput?.value) {
        vars[keyInput.value] = valueInput.value;
      }
    });
    return vars;
  }

  addVarBtn.addEventListener("click", () => addCustomVar());

  function showForm() {
    formExpanded = true;
    form.classList.remove("hidden");
    formCollapsed.classList.add("hidden");
  }

  function hideForm() {
    formExpanded = false;
    form.classList.add("hidden");
    formCollapsed.classList.remove("hidden");
  }

  showFormBtn.addEventListener("click", showForm);
  cancelFormBtn.addEventListener("click", hideForm);

  // Clear button visibility
  botNameInput.addEventListener("input", () => {
    clearBotnameBtn.classList.toggle("hidden", !botNameInput.value);
  });

  clearBotnameBtn.addEventListener("click", () => {
    botNameInput.value = "";
    clearBotnameBtn.classList.add("hidden");
  });

  async function deleteSession(id: string) {
    showConfirmModal(
      "Delete Session",
      "Are you sure you want to delete this session? This action cannot be undone.",
      async () => {
        const result = await api.deleteSession(id);
        if (result.success) {
          console.log("Session deleted successfully");
        } else {
          console.error(result.error || "Failed to delete session");
        }
      }
    );
  }

  function renderSessions(
    sessions: Array<{
      id: string;
      phone_number: string;
      created_at: number;
      status: string;
      user_info: {
        id: string;
        lid: string;
        name: string;
      };
    }>
  ) {
    console.log(sessions.length, "sessions");
    console.log(JSON.stringify(sessions, null, 2));

    sessionsLoaded = true;

    if (!sessionsList) return;

    if (!sessionCount) return;

    sessionCount.textContent = `${sessions.length} session${sessions.length !== 1 ? "s" : ""}`;

    if (sessions.length === 0) {
      sessionsList.innerHTML = `
        <div class="p-6 text-center">
          <svg class="w-12 h-12 mx-auto mb-3 text-gh-text-muted" viewBox="0 0 16 16" fill="currentColor">
            <path d="M0 1.75A.75.75 0 0 1 .75 1h4.253c1.227 0 2.317.59 3 1.501A3.743 3.743 0 0 1 11.006 1h4.245a.75.75 0 0 1 .75.75v10.5a.75.75 0 0 1-.75.75h-4.507a2.25 2.25 0 0 0-1.591.659l-.622.621a.75.75 0 0 1-1.06 0l-.622-.621A2.25 2.25 0 0 0 5.258 13H.75a.75.75 0 0 1-.75-.75Z"/>
          </svg>
          <p class="text-sm text-gh-text-secondary mb-1">No sessions yet</p>
          <p class="text-xs text-gh-text-muted">Create your first session to get started</p>
        </div>
      `;
      return;
    }

    sessionsList.innerHTML = sessions
      .map((session) => {
        const displayName =
          session?.user_info?.name || `+${session.phone_number}`;

        let statusIcon = "";

        if (session.status === "active") {
          statusIcon = `<svg class="w-4 h-4 text-gh-success" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm3.78-9.72a.751.751 0 0 0-.018-1.042.751.751 0 0 0-1.042-.018L6.75 9.19 5.28 7.72a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042l2 2a.75.75 0 0 0 1.06 0Z"/>
          </svg>`;
        } else if (
          session.status === "pairing" ||
          session.status === "connecting"
        ) {
          statusIcon = `<div class="w-4 h-4 rounded-full bg-amber-500 animate-ghost-pulse"></div>`;
        } else if (session.status === "paused_user") {
          statusIcon = `<svg class="w-4 h-4 text-amber-500" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM5.5 4.5A1.5 1.5 0 0 0 4 6v4a1.5 1.5 0 0 0 3 0V6a1.5 1.5 0 0 0-1.5-1.5Zm5 0A1.5 1.5 0 0 0 9 6v4a1.5 1.5 0 0 0 3 0V6a1.5 1.5 0 0 0-1.5-1.5Z"/>
          </svg>`;
        } else {
          statusIcon = `<svg class="w-4 h-4 text-gh-danger" viewBox="0 0 16 16" fill="currentColor">
            <path d="M2.343 13.657A8 8 0 1 1 13.658 2.343 8 8 0 0 1 2.343 13.657ZM6.03 4.97a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042L6.94 8 4.97 9.97a.749.749 0 0 0 .326 1.275.749.749 0 0 0 .734-.215L8 9.06l1.97 1.97a.749.749 0 0 0 1.275-.326.749.749 0 0 0-.215-.734L9.06 8l1.97-1.97a.749.749 0 0 0-.326-1.275.749.749 0 0 0-.734.215L8 6.94Z"/>
          </svg>`;
        }

        return `
        <div class="flex items-center justify-between p-3 hover:bg-gh-bg-secondary transition-colors" data-id="${session.id}">
          <div class="flex items-center gap-3">
            ${statusIcon}
            <span class="text-sm font-medium text-gh-text">${displayName}</span>
          </div>
          <div class="flex items-center gap-1">
            ${
              session.status === "active"
                ? `
              <a href="/dashboard/${session.id}" class="p-1.5 text-gh-text-secondary hover:text-gh-success hover:bg-gh-bg-tertiary rounded-gh transition-colors" data-tooltip="View Dashboard">
                <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm3.78-9.72a.751.751 0 0 0-.018-1.042.751.751 0 0 0-1.042-.018L6.75 9.19 5.28 7.72a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042l2 2a.75.75 0 0 0 1.06 0Z"/>
                </svg>
              </a>
              <button class="p-1.5 text-gh-text-secondary hover:text-amber-600 hover:bg-gh-bg-tertiary rounded-gh transition-colors" data-pause-session="${session.id}" data-tooltip="Pause Session">
                <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5Zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5Z"/>
                </svg>
              </button>
            `
                : session.status === "pairing"
                  ? `
              <a href="/pairing/${session.id}" class="p-1.5 text-gh-text-secondary hover:text-gh-success hover:bg-gh-bg-tertiary rounded-gh transition-colors" data-tooltip="Continue Pairing">
                <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"/>
                </svg>
              </a>
            `
                  : session.status === "connecting"
                    ? `
              <span class="p-1.5 text-gh-text-muted" data-tooltip="Connecting...">
                <div class="w-4 h-4 rounded-full bg-amber-500 animate-ghost-pulse"></div>
              </span>
            `
                    : `
              <button class="p-1.5 text-gh-text-secondary hover:text-gh-success hover:bg-gh-bg-tertiary rounded-gh transition-colors" data-resume-session="${session.id}" data-tooltip="Resume Session">
                <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"/>
                </svg>
              </button>
            `
            }
            <button class="p-1.5 text-gh-text-secondary hover:text-gh-danger hover:bg-gh-danger-subtle rounded-gh transition-colors" data-delete-session="${session.id}" data-tooltip="Delete">
              <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor">
                <path d="M11 1.75V3h2.25a.75.75 0 0 1 0 1.5H2.75a.75.75 0 0 1 0-1.5H5V1.75C5 .784 5.784 0 6.75 0h2.5C10.216 0 11 .784 11 1.75ZM4.496 6.675l.66 6.6a.25.25 0 0 0 .249.225h5.19a.25.25 0 0 0 .249-.225l.66-6.6a.75.75 0 0 1 1.492.149l-.66 6.6A1.748 1.748 0 0 1 10.595 15h-5.19a1.75 1.75 0 0 1-1.741-1.575l-.66-6.6a.75.75 0 1 1 1.492-.15ZM6.5 1.75V3h3V1.75a.25.25 0 0 0-.25-.25h-2.5a.25.25 0 0 0-.25.25Z"/>
              </svg>
            </button>
          </div>
        </div>
      `;
      })
      .join("");
  }

  const pendingActions = new Set<string>();

  sessionsList?.addEventListener("click", async (e) => {
    const target = e.target as HTMLElement;
    const button = target.closest(
      "[data-delete-session], [data-pause-session], [data-resume-session]"
    ) as HTMLElement | null;
    if (!button) return;

    const deleteId = button.getAttribute("data-delete-session");
    const pauseId = button.getAttribute("data-pause-session");
    const resumeId = button.getAttribute("data-resume-session");

    if (deleteId) {
      deleteSession(deleteId);
      return;
    }

    if (pauseId) {
      if (pendingActions.has(`pause-${pauseId}`)) return;
      pendingActions.add(`pause-${pauseId}`);
      console.log("Pausing session:", pauseId);

      try {
        const result = await api.sendAction("pauseSession", { id: pauseId });
        if (result.success) {
          console.log("Session paused successfully");
        } else {
          console.error("Failed to pause session:", result.error);
          alert(`Failed to pause session: ${result.error}`);
        }
      } catch (error) {
        console.error("Error pausing session:", error);
        alert("Failed to pause session");
      } finally {
        pendingActions.delete(`pause-${pauseId}`);
      }
      return;
    }

    if (resumeId) {
      if (pendingActions.has(`resume-${resumeId}`)) return;
      pendingActions.add(`resume-${resumeId}`);
      console.log("Resuming session:", resumeId);

      try {
        const result = await api.sendAction("resumeSession", { id: resumeId });
        if (result.success) {
          console.log("Session resumed successfully");
        } else {
          console.error("Failed to resume session:", result.error);
          alert(`Failed to resume session: ${result.error}`);
        }
      } catch (error) {
        console.error("Error resuming session:", error);
        alert("Failed to resume session");
      } finally {
        pendingActions.delete(`resume-${resumeId}`);
      }
      return;
    }
  });

  function updateStats(overall: {
    totalSessions: number;
    activeSessions: number;
    totalMessages: number;
  }) {
    const statSessions = document.getElementById("stat-sessions");
    const statActive = document.getElementById("stat-active");
    const statMessages = document.getElementById("stat-messages");

    if (statSessions)
      statSessions.textContent = overall.totalSessions.toString();
    if (statActive) statActive.textContent = overall.activeSessions.toString();
    if (statMessages)
      statMessages.textContent = overall.totalMessages.toLocaleString();
  }

  // Subscribe to real-time updates via WebSocket
  api.onStats((data) => {
    console.log(JSON.stringify(data, null, 2));

    if (data && data.type === "stats" && data.data) {
      if (data.data.overall) {
        updateStats(data.data.overall);
      }
      const sessionsData = data.data.sessions;
      if (sessionsData && Array.isArray(sessionsData)) {
        console.log("Rendering", sessionsData.length, "sessions");
        renderSessions(
          sessionsData.map((s: any) => ({
            id: s.id,
            phone_number: s.phone_number,
            created_at: s.created_at,
            status: s.status,
            user_info: s.user_info,
          }))
        );
      }
    }
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const phoneInput = document.getElementById("phone") as HTMLInputElement;
    const phoneNumber = phoneInput.value.replace(/\D/g, "");

    if (!phoneNumber) {
      showError("Please enter a valid phone number");
      return;
    }

    const submitBtn = form.querySelector(
      'button[type="submit"]'
    ) as HTMLButtonElement;
    submitBtn.disabled = true;
    submitBtn.textContent = "Creating...";
    hideError();

    const result = await api.createSession(phoneNumber);

    if (result.success && result.data) {
      window.location.href = `/pairing/${result.data.id}?code=${result.data.code}`;
    } else {
      showError(result.error || "Failed to create session");
      submitBtn.disabled = false;
      submitBtn.textContent = "Create Session";
    }
  });

  function showError(message: string) {
    errorDiv.textContent = message;
    errorDiv.classList.remove("hidden");
  }

  function hideError() {
    errorDiv.classList.add("hidden");
  }

  // Sessions section collapse functionality
  const sessionsHeader = document.getElementById("sessions-header");
  const sessionsChevron = document.getElementById("sessions-chevron");
  let sessionsCollapsed = false;

  sessionsHeader?.addEventListener("click", () => {
    sessionsCollapsed = !sessionsCollapsed;
    if (sessionsCollapsed) {
      sessionsList?.classList.add("hidden");
      sessionsChevron?.classList.add("-rotate-90");
    } else {
      sessionsList?.classList.remove("hidden");
      sessionsChevron?.classList.remove("-rotate-90");
    }
  });

  // New Session section collapse functionality
  const newSessionHeader = document.getElementById("new-session-header");
  const newSessionContent = document.getElementById("new-session-content");
  const newSessionChevron = document.getElementById("new-session-chevron");
  let newSessionCollapsed = false;

  newSessionHeader?.addEventListener("click", () => {
    newSessionCollapsed = !newSessionCollapsed;
    if (newSessionCollapsed) {
      newSessionContent?.classList.add("hidden");
      newSessionChevron?.classList.add("-rotate-90");
    } else {
      newSessionContent?.classList.remove("hidden");
      newSessionChevron?.classList.remove("-rotate-90");
    }
  });

  const mobileSettings = document.getElementById("mobile-settings");
  const mobileConsole = document.getElementById("mobile-console");

  mobileSettings?.addEventListener("click", () => {
    settingsModal?.classList.remove("hidden");
    loadSessionsIntoSelect();
  });

  mobileConsole?.addEventListener("click", () => {
    logsModal?.classList.remove("hidden");
    updateLogsDisplay();
  });

  const logsModal = document.getElementById("logs-modal");
  const logsModalBackdrop = document.getElementById("logs-modal-backdrop");
  const closeLogsModal = document.getElementById("close-logs-modal");
  const sidebarConsole = document.getElementById("sidebar-console");
  const logsContainer = document.getElementById("logs-container");

  const appLogs: string[] = [];
  const MAX_LOGS = 100;

  function addLog(message: string) {
    const timestamp = new Date().toISOString().slice(11, 23);
    appLogs.push(`[${timestamp}] ${message}`);
    if (appLogs.length > MAX_LOGS) appLogs.shift();
    updateLogsDisplay();
  }

  function updateLogsDisplay() {
    if (logsContainer) {
      logsContainer.innerHTML =
        appLogs.length > 0
          ? appLogs.map((log) => `<div class="py-0.5">${log}</div>`).join("")
          : '<p class="text-gh-text-muted">No logs yet...</p>';
      logsContainer.scrollTop = logsContainer.scrollHeight;
    }
  }

  // Override console.log to capture logs
  const originalConsoleLog = console.log;
  console.log = (...args: unknown[]) => {
    originalConsoleLog(...args);
    const message = args
      .map((arg) =>
        typeof arg === "object" ? JSON.stringify(arg) : String(arg)
      )
      .join(" ");
    addLog(message);
  };

  sidebarConsole?.addEventListener("click", () => {
    logsModal?.classList.remove("hidden");
    updateLogsDisplay();
  });

  closeLogsModal?.addEventListener("click", () => {
    logsModal?.classList.add("hidden");
  });

  logsModalBackdrop?.addEventListener("click", () => {
    logsModal?.classList.add("hidden");
  });

  // Create session modal functionality
  const createModal = document.getElementById("create-session-modal");
  const createModalBackdrop = document.getElementById(
    "create-session-modal-backdrop"
  );
  const closeCreateModal = document.getElementById("close-create-modal");
  const modalForm = document.getElementById(
    "modal-session-form"
  ) as HTMLFormElement;
  const modalErrorDiv = document.getElementById("modal-error-message");

  closeCreateModal?.addEventListener("click", () => {
    createModal?.classList.add("hidden");
  });

  createModalBackdrop?.addEventListener("click", () => {
    createModal?.classList.add("hidden");
  });

  modalForm?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const phoneInput = document.getElementById(
      "modal-phone"
    ) as HTMLInputElement | null;
    if (!phoneInput) return;

    const phoneNumber = phoneInput.value.replace(/\D/g, "");

    if (!phoneNumber) {
      if (modalErrorDiv) {
        modalErrorDiv.textContent = "Please enter a valid phone number";
        modalErrorDiv.classList.remove("hidden");
      }
      return;
    }

    const submitBtn = modalForm.querySelector(
      'button[type="submit"]'
    ) as HTMLButtonElement | null;
    if (!submitBtn) return;

    submitBtn.disabled = true;
    submitBtn.textContent = "Creating...";
    modalErrorDiv?.classList.add("hidden");

    const result = await api.createSession(phoneNumber);

    if (result.success && result.data) {
      window.location.href = `/pairing/${result.data.id}?code=${result.data.code}`;
    } else {
      if (modalErrorDiv) {
        modalErrorDiv.textContent = result.error || "Failed to create session";
        modalErrorDiv.classList.remove("hidden");
      }
      submitBtn.disabled = false;
      submitBtn.textContent = "Create Session";
    }
  });

  // Add initial log
  addLog("Application initialized");

  // Settings modal functionality
  const settingsModal = document.getElementById("settings-modal");
  const settingsModalBackdrop = document.getElementById(
    "settings-modal-backdrop"
  );
  const closeSettingsModal = document.getElementById("close-settings-modal");
  const sidebarSettings = document.getElementById("sidebar-settings");
  const settingsSessionSelect = document.getElementById(
    "settings-session-select"
  ) as HTMLSelectElement;
  const settingsList = document.getElementById("settings-list");
  const settingsLoading = document.getElementById("settings-loading");
  const settingsNoSessions = document.getElementById("settings-no-sessions");

  interface ActivitySettings {
    auto_read_messages: boolean;
    auto_recover_deleted_messages: boolean;
    auto_antispam: boolean;
    auto_typing: boolean;
    auto_recording: boolean;
    auto_reject_calls: boolean;
    auto_always_online: boolean;
  }

  let currentSettings: ActivitySettings | null = null;
  let currentSessionId: string | null = null;
  let availableSessions: Array<{
    id: string;
    phone_number: string;
    status: string;
    user_info?: { name: string };
  }> = [];

  function loadSessionsIntoSelect() {
    if (!settingsSessionSelect) return;

    // Clear existing options (except the first placeholder)
    settingsSessionSelect.length = 1;

    if (availableSessions.length === 0) {
      settingsNoSessions?.classList.remove("hidden");
      settingsList?.classList.add("hidden");
      return;
    }

    settingsNoSessions?.classList.add("hidden");

    availableSessions.forEach((session) => {
      const option = document.createElement("option");
      option.value = session.id;
      option.textContent =
        session.user_info?.name || `+${session.phone_number}`;
      settingsSessionSelect.appendChild(option);
    });

    // If there's only one session, select it automatically
    if (availableSessions.length === 1) {
      settingsSessionSelect.value = availableSessions[0].id;
      loadSettingsForSession(availableSessions[0].id);
    }
  }

  async function loadSettingsForSession(sessionId: string) {
    if (!sessionId) {
      settingsList?.classList.add("hidden");
      return;
    }

    currentSessionId = sessionId;
    settingsLoading?.classList.remove("hidden");
    settingsList?.classList.add("hidden");

    try {
      const result = await api.getActivitySettings(sessionId);
      if (result.success && result.data) {
        currentSettings = result.data;
        updateSettingsUI(result.data);
        settingsList?.classList.remove("hidden");
      } else {
        console.error("Failed to load settings:", result.error);
      }
    } catch (error) {
      console.error("Error loading settings:", error);
    } finally {
      settingsLoading?.classList.add("hidden");
    }
  }

  function updateSettingsUI(settings: ActivitySettings) {
    const settingKeys: (keyof ActivitySettings)[] = [
      "auto_always_online",
      "auto_typing",
      "auto_recording",
      "auto_read_messages",
      "auto_reject_calls",
      "auto_recover_deleted_messages",
      "auto_antispam",
    ];

    settingKeys.forEach((key) => {
      const toggle = document.getElementById(`toggle-${key}`);
      if (toggle) {
        const isEnabled = settings[key];
        toggle.setAttribute("aria-checked", String(isEnabled));

        if (isEnabled) {
          toggle.classList.remove("bg-gh-bg-tertiary");
          toggle.classList.add("bg-gh-success");
          const span = toggle.querySelector("span");
          if (span) {
            span.classList.remove("translate-x-0");
            span.classList.add("translate-x-5");
          }
        } else {
          toggle.classList.remove("bg-gh-success");
          toggle.classList.add("bg-gh-bg-tertiary");
          const span = toggle.querySelector("span");
          if (span) {
            span.classList.remove("translate-x-5");
            span.classList.add("translate-x-0");
          }
        }
      }
    });
  }

  async function toggleSetting(settingKey: keyof ActivitySettings) {
    if (!currentSessionId || !currentSettings) return;

    const newValue = !currentSettings[settingKey];

    try {
      const result = await api.updateActivitySettings(currentSessionId, {
        [settingKey]: newValue,
      });

      if (result.success && result.data) {
        currentSettings = result.data;
        updateSettingsUI(result.data);
        console.log(`Setting ${settingKey} updated to ${newValue}`);
      } else {
        console.error("Failed to update setting:", result.error);
      }
    } catch (error) {
      console.error("Error updating setting:", error);
    }
  }

  // Add click handlers for toggle buttons
  document.querySelectorAll("[data-setting]").forEach((toggle) => {
    toggle.addEventListener("click", () => {
      const settingKey = toggle.getAttribute(
        "data-setting"
      ) as keyof ActivitySettings;
      if (settingKey) {
        toggleSetting(settingKey);
      }
    });
  });

  settingsSessionSelect?.addEventListener("change", (e) => {
    const target = e.target as HTMLSelectElement;
    loadSettingsForSession(target.value);
  });

  sidebarSettings?.addEventListener("click", () => {
    settingsModal?.classList.remove("hidden");
    loadSessionsIntoSelect();
  });

  closeSettingsModal?.addEventListener("click", () => {
    settingsModal?.classList.add("hidden");
  });

  settingsModalBackdrop?.addEventListener("click", () => {
    settingsModal?.classList.add("hidden");
  });

  // Store sessions from stats updates
  api.onStats((data) => {
    if (data && data.type === "stats" && data.data && data.data.sessions) {
      availableSessions = data.data.sessions.map((s) => ({
        id: s.id,
        phone_number: s.phone_number,
        status: s.status,
        user_info: s.user_info,
      }));
    }
  });

  // Info Modal functionality
  const infoModal = document.getElementById("info-modal");
  const infoModalBackdrop = document.getElementById("info-modal-backdrop");
  const closeInfoModal = document.getElementById("close-info-modal");
  const sidebarInfo = document.getElementById("sidebar-info");
  const mobileInfo = document.getElementById("mobile-info");

  // Info display elements
  const infoRuntimeVersion = document.getElementById("info-runtime-version");
  const infoPlatform = document.getElementById("info-platform");
  const infoArch = document.getElementById("info-arch");
  const infoBrowser = document.getElementById("info-browser");
  const infoLanguage = document.getElementById("info-language");
  const infoScreen = document.getElementById("info-screen");
  const infoOnline = document.getElementById("info-online");
  const infoAppVersion = document.getElementById("info-app-version");
  const infoBotName = document.getElementById("info-bot-name");
  const infoSessions = document.getElementById("info-sessions");
  const infoActive = document.getElementById("info-active");
  const infoUrl = document.getElementById("info-url");
  const infoTimestamp = document.getElementById("info-timestamp");

  function getBrowserInfo(): string {
    const ua = navigator.userAgent;
    if (ua.includes("Firefox")) return "Firefox";
    if (ua.includes("Edg")) return "Edge";
    if (ua.includes("Chrome")) return "Chrome";
    if (ua.includes("Safari")) return "Safari";
    if (ua.includes("Opera")) return "Opera";
    return "Unknown";
  }

  async function updateInfoModal() {
    // Browser info
    if (infoBrowser) infoBrowser.textContent = getBrowserInfo();
    if (infoLanguage) infoLanguage.textContent = navigator.language;
    if (infoScreen)
      infoScreen.textContent = `${window.screen.width}x${window.screen.height}`;
    if (infoOnline) infoOnline.textContent = navigator.onLine ? "Yes" : "No";
    if (infoUrl) infoUrl.textContent = window.location.hostname;
    if (infoTimestamp) infoTimestamp.textContent = new Date().toLocaleString();

    // Try to get config info from API
    try {
      const configResult = await api.getConfig();
      if (configResult.success && configResult.data) {
        if (infoAppVersion)
          infoAppVersion.textContent = configResult.data.version;
        if (infoBotName) infoBotName.textContent = configResult.data.botName;
      }

      const statsResult = await api.getOverallStats();
      if (statsResult.success && statsResult.data) {
        if (infoSessions)
          infoSessions.textContent = String(statsResult.data.totalSessions);
        if (infoActive)
          infoActive.textContent = String(statsResult.data.activeSessions);
        if (infoRuntimeVersion)
          infoRuntimeVersion.textContent = statsResult.data.version || "Bun";
      }
    } catch (error) {
      console.error("Failed to fetch info:", error);
    }

    // Platform detection from user agent
    const ua = navigator.userAgent.toLowerCase();
    let platform = "Unknown";
    if (ua.includes("win")) platform = "Windows";
    else if (ua.includes("mac")) platform = "macOS";
    else if (ua.includes("linux")) platform = "Linux";
    else if (ua.includes("android")) platform = "Android";
    else if (ua.includes("iphone") || ua.includes("ipad")) platform = "iOS";
    if (infoPlatform) infoPlatform.textContent = platform;

    // Architecture estimation
    let arch = "Unknown";
    if (ua.includes("x64") || ua.includes("amd64") || ua.includes("win64"))
      arch = "x86_64";
    else if (ua.includes("arm64") || ua.includes("aarch64")) arch = "ARM64";
    else if (ua.includes("x86") || ua.includes("i686")) arch = "x86";
    if (infoArch) infoArch.textContent = arch;
  }

  function openInfoModal() {
    infoModal?.classList.remove("hidden");
    updateInfoModal();
  }

  sidebarInfo?.addEventListener("click", openInfoModal);
  mobileInfo?.addEventListener("click", openInfoModal);

  closeInfoModal?.addEventListener("click", () => {
    infoModal?.classList.add("hidden");
  });

  infoModalBackdrop?.addEventListener("click", () => {
    infoModal?.classList.add("hidden");
  });

  // Report Modal functionality
  const reportModal = document.getElementById("report-modal");
  const reportModalBackdrop = document.getElementById("report-modal-backdrop");
  const closeReportModal = document.getElementById("close-report-modal");
  const sidebarReport = document.getElementById("sidebar-report");
  const mobileReport = document.getElementById("mobile-report");
  const reportForm = document.getElementById("report-form") as HTMLFormElement;
  const reportType = document.getElementById(
    "report-type"
  ) as HTMLSelectElement;
  const reportMessage = document.getElementById(
    "report-message"
  ) as HTMLTextAreaElement;
  const reportImage = document.getElementById(
    "report-image"
  ) as HTMLInputElement;
  const reportWordCount = document.getElementById("report-word-count");
  const reportErrorMessage = document.getElementById("report-error-message");
  const reportCancel = document.getElementById("report-cancel");

  function countWords(text: string): number {
    return text
      .trim()
      .split(/\s+/)
      .filter((word) => word.length > 0).length;
  }

  function updateWordCount() {
    const count = countWords(reportMessage?.value || "");
    if (reportWordCount) {
      reportWordCount.textContent = `${count} word${count !== 1 ? "s" : ""}`;
      if (count < 15) {
        reportWordCount.classList.remove("text-gh-success");
        reportWordCount.classList.add("text-gh-text-muted");
      } else {
        reportWordCount.classList.remove("text-gh-text-muted");
        reportWordCount.classList.add("text-gh-success");
      }
    }
  }

  reportMessage?.addEventListener("input", updateWordCount);

  function openReportModal() {
    reportModal?.classList.remove("hidden");
    reportForm?.reset();
    updateWordCount();
    reportErrorMessage?.classList.add("hidden");
  }

  sidebarReport?.addEventListener("click", openReportModal);
  mobileReport?.addEventListener("click", openReportModal);

  closeReportModal?.addEventListener("click", () => {
    reportModal?.classList.add("hidden");
  });

  reportModalBackdrop?.addEventListener("click", () => {
    reportModal?.classList.add("hidden");
  });

  reportCancel?.addEventListener("click", () => {
    reportModal?.classList.add("hidden");
  });

  reportForm?.addEventListener("submit", async (e) => {
    e.preventDefault();
    reportErrorMessage?.classList.add("hidden");

    const type = reportType?.value;
    const message = reportMessage?.value || "";
    const wordCount = countWords(message);

    // Validation
    if (!type) {
      if (reportErrorMessage) {
        reportErrorMessage.textContent = "Please select a report type.";
        reportErrorMessage.classList.remove("hidden");
      }
      return;
    }

    if (wordCount < 15) {
      if (reportErrorMessage) {
        reportErrorMessage.textContent = `Message must contain at least 15 words. Currently: ${wordCount} word${wordCount !== 1 ? "s" : ""}.`;
        reportErrorMessage.classList.remove("hidden");
      }
      return;
    }

    // Check image size if provided
    const imageFile = reportImage?.files?.[0];
    if (imageFile && imageFile.size > 5 * 1024 * 1024) {
      if (reportErrorMessage) {
        reportErrorMessage.textContent =
          "Image file size must be less than 5MB.";
        reportErrorMessage.classList.remove("hidden");
      }
      return;
    }

    // Build the email content
    const typeLabels: Record<string, string> = {
      bug: "Bug Report",
      feature: "Feature Request",
      other: "Other",
    };
    const typeLabel = typeLabels[type] || "Report";

    let emailBody = `Report Type: ${typeLabel}\n\n`;
    emailBody += `Message:\n${message}\n\n`;
    emailBody += `---\n`;
    emailBody += `Browser: ${getBrowserInfo()}\n`;
    emailBody += `Screen: ${window.screen.width}x${window.screen.height}\n`;
    emailBody += `Timestamp: ${new Date().toISOString()}\n`;

    if (imageFile) {
      emailBody += `\n[Image attached: ${imageFile.name}]\nNote: Please attach the image manually to this email.`;
    }

    const subject = encodeURIComponent(`[WA Runtime] ${typeLabel}`);
    const body = encodeURIComponent(emailBody);
    const mailtoUrl = `mailto:astrodevwork@gmail.com?subject=${subject}&body=${body}`;

    // Open mail client
    window.location.href = mailtoUrl;

    // Close modal after short delay
    setTimeout(() => {
      reportModal?.classList.add("hidden");
      reportForm?.reset();
      updateWordCount();
    }, 500);
  });

  // Theme Toggle functionality
  const themeToggle = document.getElementById("theme-toggle");
  const themeIconLight = document.getElementById("theme-icon-light");
  const themeIconDark = document.getElementById("theme-icon-dark");
  const themeIconAuto = document.getElementById("theme-icon-auto");

  type ThemeMode = "light" | "dark" | "auto";

  function updateThemeIcon(theme: ThemeMode) {
    themeIconLight?.classList.add("hidden");
    themeIconDark?.classList.add("hidden");
    themeIconAuto?.classList.add("hidden");

    if (theme === "light") {
      themeIconLight?.classList.remove("hidden");
    } else if (theme === "dark") {
      themeIconDark?.classList.remove("hidden");
    } else {
      themeIconAuto?.classList.remove("hidden");
    }
  }

  function cycleTheme() {
    const themeManager = (window as any).themeManager;
    if (!themeManager) return;

    const currentTheme = themeManager.getTheme() as ThemeMode;
    let nextTheme: ThemeMode;

    if (currentTheme === "auto") {
      nextTheme = "light";
    } else if (currentTheme === "light") {
      nextTheme = "dark";
    } else {
      nextTheme = "auto";
    }

    themeManager.setTheme(nextTheme);
    updateThemeIcon(nextTheme);

    // Update tooltip
    const tooltipText =
      nextTheme === "auto"
        ? "Auto Theme"
        : nextTheme === "light"
          ? "Light Mode"
          : "Dark Mode";
    themeToggle?.setAttribute("data-tooltip", tooltipText);
  }

  // Initialize theme icon on page load
  const initTheme = () => {
    const themeManager = (window as any).themeManager;
    if (themeManager) {
      const currentTheme = themeManager.getTheme() as ThemeMode;
      updateThemeIcon(currentTheme);
      const tooltipText =
        currentTheme === "auto"
          ? "Auto Theme"
          : currentTheme === "light"
            ? "Light Mode"
            : "Dark Mode";
      themeToggle?.setAttribute("data-tooltip", tooltipText);
    }
  };

  initTheme();

  themeToggle?.addEventListener("click", cycleTheme);

  // ========================================
  // Memory Usage Chart Implementation
  // ========================================
  
  interface MemoryDataPoint {
    timestamp: number;
    value: number; // MB
  }
  
  // Memory data store - stores data for different time ranges
  const memoryData: MemoryDataPoint[] = [];
  let currentMemoryRange = 60; // Default: 1 minute (60 seconds)
  let memoryUpdateInterval: ReturnType<typeof setInterval> | null = null;
  
  // Get memory chart elements
  const memoryChartSvg = document.getElementById("memory-chart-svg");
  const memoryLine = document.getElementById("memory-line");
  const memoryArea = document.getElementById("memory-area");
  const memoryDots = document.getElementById("memory-dots");
  const memorySkeleton = document.getElementById("memory-skeleton");
  const memoryCurrentEl = document.getElementById("memory-current");
  const memoryMaxLabel = document.getElementById("memory-max-label");
  const memoryMidLabel = document.getElementById("memory-mid-label");
  const memoryMinLabel = document.getElementById("memory-min-label");
  const memoryTimeStart = document.getElementById("memory-time-start");
  const memoryPeakEl = document.getElementById("memory-peak");
  const memoryAvgEl = document.getElementById("memory-avg");
  const memoryUsedEl = document.getElementById("memory-used");
  const memoryTooltip = document.getElementById("memory-tooltip");
  
  // Range buttons
  const rangeButtons = document.querySelectorAll("[data-range]");
  
  // Format memory size
  function formatMemory(mb: number): string {
    if (mb >= 1024) {
      return `${(mb / 1024).toFixed(1)} GB`;
    }
    return `${mb.toFixed(0)} MB`;
  }
  
  // Format time for labels
  function formatTimeLabel(seconds: number): string {
    if (seconds >= 3600) {
      return `${Math.floor(seconds / 3600)}h ago`;
    } else if (seconds >= 60) {
      return `${Math.floor(seconds / 60)}m ago`;
    }
    return `${seconds}s ago`;
  }
  
  // Generate simulated memory data with more volatility (like forex)
  function getMemoryUsage(): number {
    // Try to use the Performance API if available (Chrome)
    const perf = (performance as any);
    if (perf?.memory) {
      const usedHeapMB = perf.memory.usedJSHeapSize / (1024 * 1024);
      return usedHeapMB;
    }
    // Fallback: simulate realistic memory usage with more dynamic movements
    const baseMemory = 100;
    const lastValue = memoryData.length > 0 ? memoryData[memoryData.length - 1].value : baseMemory;
    
    // Create more volatility with larger random movements
    const volatility = 15; // Larger swings
    const trend = (Math.random() - 0.5) * 2; // Random trend direction
    const spike = Math.random() > 0.9 ? (Math.random() - 0.5) * 30 : 0; // Occasional spikes
    const delta = trend * volatility + spike;
    
    // Keep within reasonable bounds (50-200 MB)
    return Math.max(50, Math.min(200, lastValue + delta));
  }
  
  // Add a new memory data point
  function addMemoryDataPoint() {
    const now = Date.now();
    const value = getMemoryUsage();
    
    memoryData.push({ timestamp: now, value });
    
    // Keep data for the maximum time range (1 hour = 3600 seconds)
    const maxAge = 3600 * 1000;
    const cutoff = now - maxAge;
    while (memoryData.length > 0 && memoryData[0].timestamp < cutoff) {
      memoryData.shift();
    }
    
    updateMemoryChart();
  }
  
  // Generate smooth cubic bezier curve path for forex-like line movement
  function generateSmoothPath(points: {x: number, y: number}[]): string {
    if (points.length < 2) return '';
    
    let path = `M ${points[0].x.toFixed(1)} ${points[0].y.toFixed(1)}`;
    
    for (let i = 1; i < points.length; i++) {
      const prev = points[i - 1];
      const curr = points[i];
      
      // Calculate control points for smooth curve
      const tension = 0.3;
      const prevPrev = points[i - 2] || prev;
      const next = points[i + 1] || curr;
      
      // Control point 1 (from previous point)
      const cp1x = prev.x + (curr.x - prevPrev.x) * tension;
      const cp1y = prev.y + (curr.y - prevPrev.y) * tension;
      
      // Control point 2 (to current point)
      const cp2x = curr.x - (next.x - prev.x) * tension;
      const cp2y = curr.y - (next.y - prev.y) * tension;
      
      path += ` C ${cp1x.toFixed(1)} ${cp1y.toFixed(1)}, ${cp2x.toFixed(1)} ${cp2y.toFixed(1)}, ${curr.x.toFixed(1)} ${curr.y.toFixed(1)}`;
    }
    
    return path;
  }
  
  // Update the memory chart display
  function updateMemoryChart() {
    if (!memoryLine || !memoryDots || !memoryChartSvg) return;
    
    const now = Date.now();
    const rangeMs = currentMemoryRange * 1000;
    const cutoff = now - rangeMs;
    
    // Filter data for current range
    const filteredData = memoryData.filter(d => d.timestamp >= cutoff);
    
    if (filteredData.length === 0) {
      // Show skeleton if no data
      if (memorySkeleton) memorySkeleton.classList.remove("hidden");
      return;
    }
    
    // Hide skeleton
    if (memorySkeleton) memorySkeleton.classList.add("hidden");
    
    // Calculate stats
    const values = filteredData.map(d => d.value);
    const currentValue = values[values.length - 1];
    const maxValue = Math.max(...values);
    const minValue = Math.min(...values);
    const avgValue = values.reduce((a, b) => a + b, 0) / values.length;
    
    // Update labels
    if (memoryCurrentEl) memoryCurrentEl.textContent = formatMemory(currentValue);
    if (memoryPeakEl) memoryPeakEl.textContent = formatMemory(maxValue);
    if (memoryAvgEl) memoryAvgEl.textContent = formatMemory(avgValue);
    if (memoryUsedEl) memoryUsedEl.textContent = formatMemory(currentValue);
    
    // Calculate Y-axis range with padding
    const yMin = Math.max(0, minValue - 15);
    const yMax = maxValue + 15;
    const yRange = yMax - yMin;
    
    // Update Y-axis labels
    if (memoryMaxLabel) memoryMaxLabel.textContent = formatMemory(yMax);
    if (memoryMidLabel) memoryMidLabel.textContent = formatMemory((yMax + yMin) / 2);
    if (memoryMinLabel) memoryMinLabel.textContent = formatMemory(yMin);
    
    // Update time label
    if (memoryTimeStart) memoryTimeStart.textContent = formatTimeLabel(currentMemoryRange);
    
    // Chart dimensions
    const chartWidth = 400;
    const chartHeight = 128;
    const padding = { top: 8, bottom: 8, left: 0, right: 0 };
    const plotWidth = chartWidth - padding.left - padding.right;
    const plotHeight = chartHeight - padding.top - padding.bottom;
    
    // Generate point coordinates
    const pointCoords: {x: number, y: number}[] = [];
    const dotElements: string[] = [];
    
    filteredData.forEach((point, index) => {
      // X position based on time
      const timeOffset = now - point.timestamp;
      const x = padding.left + plotWidth * (1 - timeOffset / rangeMs);
      
      // Y position based on value (inverted because SVG Y is top-down)
      const y = padding.top + plotHeight * (1 - (point.value - yMin) / yRange);
      
      pointCoords.push({ x, y });
      
      // Add dots at regular intervals or for the last point
      const showDot = index === filteredData.length - 1 || index % Math.max(1, Math.floor(filteredData.length / 8)) === 0;
      if (showDot) {
        dotElements.push(`
          <circle 
            cx="${x.toFixed(1)}" 
            cy="${y.toFixed(1)}" 
            r="3" 
            fill="var(--gh-success)"
            class="memory-dot cursor-pointer transition-all"
            style="transform-origin: center; transform-box: fill-box;"
            data-value="${point.value.toFixed(1)}"
            data-time="${new Date(point.timestamp).toLocaleTimeString()}"
          />
        `);
      }
    });
    
    // Generate smooth curve path
    const smoothPath = generateSmoothPath(pointCoords);
    memoryLine.setAttribute("d", smoothPath);
    
    // Generate area fill path (close the path at the bottom)
    if (memoryArea && pointCoords.length > 0) {
      const firstPoint = pointCoords[0];
      const lastPoint = pointCoords[pointCoords.length - 1];
      const areaPath = smoothPath + 
        ` L ${lastPoint.x.toFixed(1)} ${(chartHeight - padding.bottom).toFixed(1)}` +
        ` L ${firstPoint.x.toFixed(1)} ${(chartHeight - padding.bottom).toFixed(1)} Z`;
      memoryArea.setAttribute("d", areaPath);
    }
    
    // Update dots
    memoryDots.innerHTML = dotElements.join("");
    
    // Add hover handlers for dots
    if (memoryTooltip) {
      const dots = memoryDots.querySelectorAll(".memory-dot");
      dots.forEach((dot) => {
        dot.addEventListener("mouseenter", (e) => {
          const target = e.target as SVGCircleElement;
          const value = target.getAttribute("data-value");
          const time = target.getAttribute("data-time");
          
          memoryTooltip.textContent = `${formatMemory(parseFloat(value || "0"))} at ${time}`;
          memoryTooltip.style.opacity = "1";
          
          const rect = target.getBoundingClientRect();
          const containerRect = memoryChartSvg.parentElement?.getBoundingClientRect();
          if (containerRect) {
            const left = rect.left - containerRect.left + rect.width / 2;
            const top = rect.top - containerRect.top - 28;
            memoryTooltip.style.left = `${left}px`;
            memoryTooltip.style.top = `${top}px`;
          }
        });
        
        dot.addEventListener("mouseleave", () => {
          memoryTooltip.style.opacity = "0";
        });
      });
    }
  }
  
  // Handle range button clicks
  rangeButtons.forEach((button) => {
    button.addEventListener("click", () => {
      const range = parseInt(button.getAttribute("data-range") || "60", 10);
      currentMemoryRange = range;
      
      // Update button styles
      rangeButtons.forEach((btn) => {
        btn.classList.remove("bg-gh-bg-tertiary", "text-gh-text");
        btn.classList.add("text-gh-text-secondary");
      });
      button.classList.remove("text-gh-text-secondary");
      button.classList.add("bg-gh-bg-tertiary", "text-gh-text");
      
      // Redraw chart
      updateMemoryChart();
    });
  });
  
  // Start memory tracking
  function startMemoryTracking() {
    // Add initial data point
    addMemoryDataPoint();
    
    // Update every second
    if (memoryUpdateInterval) clearInterval(memoryUpdateInterval);
    memoryUpdateInterval = setInterval(addMemoryDataPoint, 1000);
  }
  
  // Start tracking when page loads
  startMemoryTracking();
  
  // Cleanup on page unload
  window.addEventListener("beforeunload", () => {
    if (memoryUpdateInterval) {
      clearInterval(memoryUpdateInterval);
    }
  });
</script>
